<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Add a polygon to a map using a GeoJSON source</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
<link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
<!-- Import Turf Module - Needed to calculate bounding boxes -->
<script src='https://api.mapbox.com/mapbox.js/plugins/turf/v2.0.2/turf.min.js'></script>
<style>
    body { margin: 0; padding: 0; }
    #map { position: absolute; top: 0; bottom: 0; width: 100%; }

    /* Control the zoom to button */
    .btn-control {
        font: bold 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
        background-color: #3386c0;
        color: #fff;
        position: absolute;
        top: 20px;
        left: 50%;
        z-index: 1;
        border: none;
        width: 200px;
        margin-left: -100px;
        display: block;
        cursor: pointer;
        padding: 10px 20px;
        border-radius: 3px;
    }
    .btn-control:hover {
        background-color: #4ea0da;
    }
</style>
</head>
<body>
<button id="zoomto" class="btn-control">Zoom to Footprint</button>
<div id="map"></div>
<script>
	// Replace access token!
    mapboxgl.accessToken = 'pk.eyJ1IjoidWJjbWljcm9tZXQiLCJhIjoiY2xmMnJzYzlnMGFsYTNxcW1kYWhubjBiaSJ9.rhIOVatxQoS4M__qIFv6Pg';
  
    //  Custom mapStyle lest us use ESRI raster tiles
    const mapStyle = {
        version: 8,
        sources: {
        worldImagery: {
            type: "raster",
            tiles: ["https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"],
            tileSize: 256
            }
        },
        layers: [{
            id: "worldImagery",
            type: "raster",
            source: "worldImagery",
            minzoom: 0,
            maxzoom: 22
            }
        ]
    };

    //  Create the map - zoom and center are "arbitrary"
    const map = new mapboxgl.Map({
                container: 'map',
                zoom: 10,
                center: [-122.984902, 49.129344], // starting position
                style: mapStyle,
                });

    //  Locate the user
    var geolocate = new mapboxgl.GeolocateControl({
        positionOptions: {
        enableHighAccuracy: true
        },
        trackUserLocation: true,
        showUserHeading: true},);

    map.addControl(geolocate);
    map.addControl(new mapboxgl.NavigationControl());  

    var FP_Contour_Levels = {"type": "FeatureCollection", "features": [{"id": "2", "type": "Feature", "properties": {"r": 0.9, "r_true": 0.9000095928559065, "Contour_Level": "90 % Flux Source Area Contour"}, "geometry": {"type": "Polygon", "coordinates": [[[-122.98431223054308, 49.12857814956651], [-122.98428478955934, 49.1285750816232], [-122.98425734783294, 49.12857437008404], [-122.98422990519437, 49.1285765372291], [-122.98421985204178, 49.128578533170675], [-122.98420246137111, 49.12858242571203], [-122.98417501586907, 49.128593568798586], [-122.98417003073439, 49.12859653518981], [-122.98414756766171, 49.12861315895097], [-122.98414615716155, 49.128614540753226], [-122.98413111833975, 49.12863254752626], [-122.98412046526028, 49.12865055490054], [-122.98412011349905, 49.128651329027896], [-122.98411325949353, 49.12866856274819], [-122.98410836725836, 49.12868657091378], [-122.98410534148167, 49.12870457933608], [-122.98410386012476, 49.128722587970856], [-122.9841036841171, 49.128740596785306], [-122.98410463755097, 49.128758605755195], [-122.98410659406987, 49.128776614863106], [-122.98410946754171, 49.12879462409713], [-122.98411320581043, 49.128812633450025], [-122.98411778676031, 49.12883064291865], [-122.98412005386533, 49.12883805696511], [-122.98412293435705, 49.12884865246497], [-122.98412859763727, 49.12886666208188], [-122.98413499197426, 49.12888467179893], [-122.98414217615621, 49.12890268162405], [-122.9841474715897, 49.12891450460384], [-122.98414990822518, 49.12892069152387], [-122.98415777755741, 49.128938701441946], [-122.98416645922464, 49.128956711470835], [-122.9841748952557, 49.12897254805395], [-122.98417590588063, 49.12897472160389], [-122.98418497245972, 49.12899273168402], [-122.98419484103171, 49.12901074187319], [-122.98420232125459, 49.12902345023031], [-122.98420503085741, 49.129028752105384], [-122.98421453439985, 49.129046762242815], [-122.98422430111397, 49.12906477241537], [-122.98422974699554, 49.12907534259736], [-122.98423306325091, 49.12908278244985], [-122.98423965992139, 49.129100792188055], [-122.98424359571979, 49.12911880156271], [-122.98424246164035, 49.12913681024538], [-122.98423297697366, 49.12915481778794], [-122.98422972087023, 49.12915771508153], [-122.98420776375512, 49.129172823179395], [-122.98420227301719, 49.12917527758827], [-122.98417482746555, 49.12918554805756], [-122.9841586328982, 49.12919082528621], [-122.98414738255859, 49.129193760857994], [-122.98411993815789, 49.12920036002767], [-122.98409249379883, 49.12920680636481], [-122.98408349728776, 49.129208823790115], [-122.9840650496476, 49.12921258192805], [-122.98403760553114, 49.129218229321225], [-122.98401016132762, 49.12922412813456], [-122.98399774559938, 49.129226820774214], [-122.98398271712087, 49.12923001665866], [-122.98395527286607, 49.12923603398806], [-122.9839278284698, 49.12924246843341], [-122.983917977155, 49.129244818528115], [-122.98390038398158, 49.12924916492151], [-122.98387293935853, 49.12925625434378], [-122.98384901414427, 49.129262817738876], [-122.98384549455879, 49.12926386348028], [-122.98381804956318, 49.129272048691355], [-122.9837906043689, 49.129280815558545], [-122.98379059544529, 49.129280818389205], [-122.98376315881345, 49.12929065893526], [-122.98374148412772, 49.12929882032091], [-122.98373571295369, 49.129301399305476], [-122.9837082665635, 49.12931372240594], [-122.98370140475794, 49.129316823507004], [-122.98368081935479, 49.12932849805635], [-122.98366962798944, 49.12933482785374], [-122.98365337080286, 49.12934730979327], [-122.98364599395208, 49.12935283334534], [-122.98363022991443, 49.1293708399481], [-122.98362591739934, 49.129380791195906], [-122.98362218873672, 49.1293888476444], [-122.98362178751412, 49.129406856424076], [-122.98362590546365, 49.12941703599465], [-122.98362890979757, 49.1294248662707], [-122.98364291308775, 49.12944287709189], [-122.98365333639453, 49.129451972140735], [-122.98366320632931, 49.12946088880147], [-122.98368077177707, 49.12947346203603], [-122.98368809474599, 49.12947890115673], [-122.98370820811121, 49.12949211998483], [-122.98371516581096, 49.12949691381443], [-122.98373564451985, 49.12951061309799], [-122.98374169271116, 49.12951492638909], [-122.98376308028863, 49.12953112827433], [-122.98376527965422, 49.12953293854426], [-122.98378396254384, 49.12955095000589], [-122.98379051365788, 49.12955907327865], [-122.98379768685255, 49.129568960768715], [-122.98380669046432, 49.12958697086787], [-122.9838120115766, 49.12960498045001], [-122.98381448046358, 49.12962298963205], [-122.98381511654787, 49.12964099855707], [-122.98381497719105, 49.12965900737334], [-122.98381511691406, 49.12967701622868], [-122.98381663645175, 49.12969502527738], [-122.98381791000845, 49.12970085977514], [-122.98382072970804, 49.12971303468666], [-122.98382914073876, 49.12973104470058], [-122.98384452561507, 49.12974905568982], [-122.98384533670968, 49.12974971131628], [-122.98387206207191, 49.129767068374996], [-122.9838727735714, 49.12976740289089], [-122.98390021278597, 49.12977788836687], [-122.98392765307521, 49.12978508496224], [-122.98392765307521, 49.12978508496224], [-122.98395509416503, 49.129789825267665], [-122.9839825357653, 49.12979299721909], [-122.98400997776592, 49.12979493513384], [-122.98403742008766, 49.12979587952153], [-122.98406486267335, 49.129796003525634], [-122.98409230548218, 49.129795430454536], [-122.98411974848577, 49.12979424557458], [-122.98414719166554, 49.129792504087234], [-122.98417463501082, 49.129790236484396], [-122.98420207851782, 49.12978745203408], [-122.98422127649445, 49.12978512546227], [-122.98422952215134, 49.12978425894705], [-122.98425696583274, 49.12978090355897], [-122.98428440965226, 49.1297770994405], [-122.98431185362448, 49.129772798048066], [-122.98433929776958, 49.1297679326268], [-122.9843433297879, 49.12976713324219], [-122.98436674187778, 49.12976316757015], [-122.98439418611564, 49.12975797261722], [-122.9844216305551, 49.12975211582594], [-122.98443413871156, 49.12974913668501], [-122.98444907503156, 49.129746120149875], [-122.98447651956015, 49.12973993629887], [-122.98450396435604, 49.129732872788296], [-122.98451004971271, 49.12973113805861], [-122.98453140908539, 49.129725998051676], [-122.98455885401592, 49.129718451177744], [-122.98457577990646, 49.12971313802264], [-122.98458629910628, 49.1297103618175], [-122.9846137442199, 49.129702168369775], [-122.98463386791437, 49.12969513693238], [-122.9846411896288, 49.12969298972788], [-122.98466863501919, 49.12968383830323], [-122.9846856159232, 49.12967713497209], [-122.98469608071593, 49.129673658634424], [-122.98472352656738, 49.12966293895057], [-122.98473188666962, 49.12965913226437], [-122.98475097255468, 49.1296517376258], [-122.98477316190623, 49.12964112887935], [-122.98477841900367, 49.12963898773843], [-122.98480586566671, 49.12962549134201], [-122.98480993441665, 49.129623124887225], [-122.98483331261254, 49.12961101905377], [-122.98484256886337, 49.129605120340166], [-122.9848607601738, 49.12959447288559], [-122.98487103518282, 49.12958711523773], [-122.98488820857062, 49.12957511739038], [-122.98489541681393, 49.12956910959394], [-122.98491520603433, 49.12955110334503], [-122.98491565848023, 49.12955070483902], [-122.98493291574914, 49.12953309682131], [-122.9849431111167, 49.129517198338384], [-122.98494462916386, 49.129515089513106], [-122.98495683107083, 49.1294970822673], [-122.98496644509791, 49.12947907468321], [-122.98497056618335, 49.129475529567024], [-122.9849797122193, 49.12947907640991], [-122.98499800509663, 49.12948724708287], [-122.98502344419538, 49.129497090927096], [-122.98502544424653, 49.1294982218067], [-122.98505288300326, 49.12951054468941], [-122.9850709169438, 49.12951510591139], [-122.98508032288622, 49.1295191596449], [-122.98510776282286, 49.129527626958485], [-122.98513520366647, 49.12953309186135], [-122.98513539399453, 49.129533123066565], [-122.98516264388934, 49.129540657089116], [-122.98519008478249, 49.12954600001953], [-122.98521752605149, 49.129550098616754], [-122.98522589134656, 49.12955114351815], [-122.98524496710725, 49.129554930922545], [-122.98527240832082, 49.12955924851883], [-122.98529984978897, 49.12956272112707], [-122.98532729143533, 49.12956560282831], [-122.98535473321346, 49.12956804793366], [-122.98536951517693, 49.12956917064291], [-122.98538217497325, 49.12957056458922], [-122.98540961674746, 49.12957304150334], [-122.98543705865676, 49.12957506656679], [-122.98546450067914, 49.12957671246109], [-122.98549194280008, 49.129578026773714], [-122.98551938501029, 49.12957903963878], [-122.9855468273041, 49.12957976858549], [-122.98557426967879, 49.129580221678445], [-122.98560171213364, 49.12958039958131], [-122.9856291546698, 49.12958029692106], [-122.98565659728978, 49.12957990318571], [-122.98568403999748, 49.129579203301134], [-122.98571148279794, 49.129578177981365], [-122.98573892569729, 49.12957680391276], [-122.98576636870273, 49.12957505381274], [-122.98579381182266, 49.12957289638939], [-122.98582125506644, 49.12957029621955], [-122.98583122032281, 49.12956922822496], [-122.98584869841164, 49.12956732961187], [-122.98587614189186, 49.12956387618867], [-122.98590358554314, 49.12955980592689], [-122.98593102938266, 49.12955505448225], [-122.9859505681978, 49.12955123397319], [-122.98595847343114, 49.129549544463934], [-122.98598591772995, 49.1295431246549], [-122.98601336231074, 49.12953567734944], [-122.98602170271504, 49.129533233771014], [-122.986040807295, 49.12952676348744], [-122.9860682527075, 49.12951628619565], [-122.98607087376536, 49.12951523087736], [-122.98609569884871, 49.12950316155024], [-122.98610701873419, 49.12949722639605], [-122.98612314592319, 49.1294866410753], [-122.98613401030629, 49.12947922080446], [-122.98615059453496, 49.1294645357032], [-122.98615430575578, 49.12946121440368], [-122.98616979313498, 49.12944320742347], [-122.98617804659992, 49.129429920266205], [-122.98618107194878, 49.12942519993749], [-122.98618929103615, 49.12940719208441], [-122.98619442554701, 49.129389183861896], [-122.98619676405812, 49.129371175304875], [-122.98619633700456, 49.12935316641713], [-122.98619293968123, 49.129335157174175], [-122.9861861322601, 49.12931714752312], [-122.98617808168169, 49.12930371751995], [-122.98617542217227, 49.1292991374044], [-122.98616050493239, 49.129281126780405], [-122.9861506480542, 49.12927238783503], [-122.98614019233968, 49.12926311550689], [-122.98612321153826, 49.12925153182679], [-122.98611360300875, 49.129245103475], [-122.98609577369612, 49.129235500804604], [-122.98607948247819, 49.12922709052918], [-122.98606833508653, 49.129222271972004], [-122.98604089593488, 49.129211026021295], [-122.98603595709321, 49.12920907643612], [-122.98601345635684, 49.1292013399003], [-122.98598601649348, 49.129192704218305], [-122.98598057973743, 49.12919106088811], [-122.98595857636487, 49.129185041575056], [-122.98593113602479, 49.12917815615662], [-122.98590877666959, 49.12917304330999], [-122.98590369549974, 49.12917195000413], [-122.98587625483313, 49.12916626630191], [-122.98584881400946, 49.129161156581965], [-122.9858213730368, 49.12915658912849], [-122.98581129464634, 49.12915502253431], [-122.98579393197691, 49.12915234459636], [-122.98576649082108, 49.12914845156396], [-122.98573904954485, 49.12914499333818], [-122.98571160815396, 49.12914194739063], [-122.98568416665388, 49.12913929234175], [-122.98565672504984, 49.12913700796454], [-122.9856565488349, 49.12913699457661], [-122.9856292834389, 49.129134756042546], [-122.98560184173206, 49.12913284395457], [-122.98557439993156, 49.12913126195147], [-122.98554695803973, 49.129130000180034], [-122.98551951605823, 49.12912905111471], [-122.98549207398791, 49.1291284100841], [-122.98546463182855, 49.129128076025545], [-122.98543718957858, 49.12912805258324], [-122.98540974723456, 49.129128349737314], [-122.98538230479043, 49.129128986274594], [-122.9853548622364, 49.12912999363583], [-122.985327419557, 49.12913142209098], [-122.98529997672806, 49.129133351007376], [-122.98527253371137, 49.129135906640165], [-122.98526399955473, 49.129136945143], [-122.9852450907006, 49.12913843276415], [-122.98521764763719, 49.12914112661614], [-122.98519020435359, 49.129144549755644], [-122.98516276073543, 49.12914908133974], [-122.98513720330125, 49.12915493772779], [-122.9851353166388, 49.129155196798706], [-122.98510787305113, 49.129159590340265], [-122.98508042957084, 49.12916360981704], [-122.98505298921339, 49.12915722608575], [-122.98505126978478, 49.129154926633774], [-122.9850435822699, 49.12913691680082], [-122.98503627948246, 49.12911890701718], [-122.98502740596706, 49.12910089702933], [-122.98502556495644, 49.129097403192176], [-122.98501963801121, 49.12908288718418], [-122.98501016461395, 49.12906487711707], [-122.9849981378377, 49.12904728440322], [-122.98499788416704, 49.129046866684405], [-122.98498687237465, 49.12902885641536], [-122.98497296064514, 49.12901084576782], [-122.98497070749998, 49.129007998286056], [-122.98495947569317, 49.128992835174145], [-122.98494363643564, 49.12897482427183], [-122.9849432754806, 49.12897440884952], [-122.98492847905236, 49.128956813456305], [-122.98491584269023, 49.128943483051565], [-122.98491140626842, 49.12893880238843], [-122.98489394688501, 49.12892079126742], [-122.98488840911722, 49.12891524474917], [-122.98487580415276, 49.1289027800542], [-122.98486097501068, 49.12888886116209], [-122.98485646962983, 49.12888476868173], [-122.98483656035495, 49.12886675723051], [-122.98483354046562, 49.12886401065875], [-122.98481611695424, 49.128848745705554], [-122.98480610565719, 49.128840111797736], [-122.98479466202313, 49.12883073404371], [-122.98477867044456, 49.12881761947359], [-122.98477231257361, 49.12881272225985], [-122.9847512349121, 49.12879625106807], [-122.98474911469607, 49.12879471035954], [-122.98472510792968, 49.128776698347515], [-122.98472379915584, 49.12877568784666], [-122.98470016220755, 49.128758686206], [-122.9846963631903, 49.12875587831555], [-122.98467410833622, 49.12874067391195], [-122.98466892695772, 49.12873700578208], [-122.984646852935, 49.1287226614522], [-122.98464149047071, 49.12871902441415], [-122.98461825249892, 49.1287046488068], [-122.98461405373189, 49.12870192086292], [-122.98458810952793, 49.128686635948334], [-122.9845866167361, 49.128685707304726], [-122.98455917952882, 49.12867023242246], [-122.98455597480022, 49.128668622815546], [-122.98453174208586, 49.128655569968274], [-122.98452131633746, 49.128650609335445], [-122.98450430435001, 49.12864189937583], [-122.98448362456135, 49.128632595437296], [-122.98447686629042, 49.1286293140264], [-122.98444942795255, 49.12861766292775], [-122.98444096902713, 49.12861458085796], [-122.98442198930664, 49.12860703625054], [-122.98439455024358, 49.128597775969894], [-122.98439013673013, 49.128596565157636], [-122.98436711084668, 49.12858961010331], [-122.98433967095902, 49.128583031075955], [-122.98431425521338, 49.1285785460345], [-122.98431223054308, 49.12857814956651]]]}}, {"id": "1", "type": "Feature", "properties": {"r": 0.75, "r_true": 0.749992368879069, "Contour_Level": "75 % Flux Source Area Contour"}, "geometry": {"type": "Polygon", "coordinates": [[[-122.98477859502452, 49.12906399395399], [-122.98475115475634, 49.12905762468695], [-122.98472371362256, 49.12905409574409], [-122.98469627159747, 49.12905347543139], [-122.98466882847704, 49.129056409805585], [-122.98464138380956, 49.129064342190986], [-122.98464032347685, 49.129064828508916], [-122.98461393688959, 49.12907952577337], [-122.98460989362628, 49.12908283329437], [-122.98459277727423, 49.12910083984914], [-122.98458648507487, 49.12911044550639], [-122.98458168677749, 49.12911884720614], [-122.98457400361522, 49.12913685501731], [-122.98456851522465, 49.12915486312128], [-122.98456403856976, 49.12917287136019], [-122.98455947050344, 49.12919087958665], [-122.98455901743887, 49.129192203123964], [-122.98455233403345, 49.12920888746927], [-122.98454231751263, 49.12922689496584], [-122.98453155977484, 49.129241615616394], [-122.98452866529415, 49.12924490197437], [-122.98450919530477, 49.12926290820081], [-122.98450410946717, 49.12926724794438], [-122.98448581709782, 49.12928091389884], [-122.98447666063953, 49.12928804889646], [-122.98446120026286, 49.129298919425395], [-122.98444921183881, 49.12930869032797], [-122.98443815905998, 49.12931692515902], [-122.98442176197521, 49.12933265157637], [-122.98441914968203, 49.12933493143213], [-122.98440394470201, 49.12935293821604], [-122.9843947678524, 49.12937094581278], [-122.98439430700581, 49.1293727965255], [-122.98438952130066, 49.12938895394019], [-122.98438910524395, 49.12940696272052], [-122.98439321422825, 49.12942497211254], [-122.98439428988988, 49.129427331253005], [-122.98440080925387, 49.129442981975394], [-122.98441311119552, 49.12946099247321], [-122.98442171897734, 49.12946989245672], [-122.98443084783881, 49.129479003702656], [-122.98444915441033, 49.12949231446754], [-122.98445658052934, 49.12949701600603], [-122.98447659224335, 49.12950712816526], [-122.98449727511284, 49.1295150303135], [-122.98450403154258, 49.12951728963423], [-122.98453147176637, 49.12952451532575], [-122.98455891279134, 49.12952918664625], [-122.98458635442513, 49.129531910719635], [-122.9846119280913, 49.129533054487226], [-122.98461379652217, 49.12953314742839], [-122.98464123899653, 49.12953316703173], [-122.98464332344486, 49.12953305866723], [-122.98466868179624, 49.12953213154476], [-122.98469612488311, 49.12953015928384], [-122.98472356828755, 49.12952714634994], [-122.98475101208714, 49.12952283403846], [-122.98477845643652, 49.12951671025572], [-122.98478407655419, 49.12951506846614], [-122.98480590079606, 49.12951053115217], [-122.98483334577544, 49.129502297570646], [-122.98484567723027, 49.129497067731585], [-122.98486079130744, 49.12949221910177], [-122.98488563870076, 49.129479064133406], [-122.98488823811294, 49.12947791376626], [-122.98491076846648, 49.129461058583956], [-122.98491568708978, 49.12945639896615], [-122.9849266001367, 49.129443051815485], [-122.98493732531792, 49.12942504437871], [-122.98494314010694, 49.129421463291614], [-122.98494836872402, 49.12942504581889], [-122.98497057739914, 49.12943842376286], [-122.9849850851395, 49.129443059435985], [-122.98499801633686, 49.129449992415715], [-122.98502545652944, 49.12945743667716], [-122.9850504702803, 49.12946107675691], [-122.98505289766806, 49.12946176116199], [-122.9850803388084, 49.12946609592414], [-122.98510778062236, 49.129468197453264], [-122.98513522286832, 49.129468861755385], [-122.9851626654657, 49.12946835091097], [-122.98519010839655, 49.12946671844365], [-122.98521755167312, 49.12946391715563], [-122.98523738792395, 49.12946110080749], [-122.9852449952689, 49.12946002964004], [-122.98527243915132, 49.12945515993158], [-122.98529988354295, 49.12944854962437], [-122.98531834588692, 49.12944310229397], [-122.9853273285326, 49.12943988806044], [-122.98535477431352, 49.12942850755848], [-122.98536216637193, 49.12942509902135], [-122.98538222158115, 49.12941202718964], [-122.9853894085454, 49.12940709363536], [-122.98540555515514, 49.12938908684091], [-122.9854096736772, 49.12937902988302], [-122.98541327857322, 49.12937107898029], [-122.98541386030166, 49.129353070217086], [-122.98540968464322, 49.129341658440005], [-122.98540759320102, 49.12933506058844], [-122.98539518316942, 49.12931705018252], [-122.98538225285442, 49.12930565003073], [-122.98537502975194, 49.12929903879463], [-122.98535481624579, 49.12928614061078], [-122.98534655206527, 49.129281026347], [-122.98532737812943, 49.129271813654356], [-122.98530674355783, 49.12926301245088], [-122.98529993912645, 49.1292605391366], [-122.98527249951948, 49.12925134581976], [-122.98524862214059, 49.12924499620272], [-122.9852450593456, 49.12924409712436], [-122.98521761890548, 49.12923777086831], [-122.98519017799903, 49.12923303384395], [-122.98516273667148, 49.12922972544359], [-122.9851352949619, 49.12922770720528], [-122.98511156857707, 49.12922696977395], [-122.98510785291535, 49.129226821469494], [-122.98509997725995, 49.129226968278665], [-122.98508041049931, 49.12922717039359], [-122.98505296779038, 49.129228492423856], [-122.98502552530147, 49.129229079014884], [-122.98501786790712, 49.129226957653245], [-122.98499808709028, 49.12921548510991], [-122.98499306528053, 49.12920894559502], [-122.98498045627933, 49.12919093511825], [-122.9849706558688, 49.12917881603739], [-122.98496570224479, 49.12917292436078], [-122.98494843580335, 49.12915491327384], [-122.9849432223516, 49.12914986198932], [-122.98492724350629, 49.129136901671835], [-122.98491578677313, 49.12912780795578], [-122.9849016363295, 49.12911888948866], [-122.98488834995023, 49.129109928614774], [-122.98487094741323, 49.129100876633956], [-122.98486091224547, 49.12909501048457], [-122.98483347371213, 49.129082862880004], [-122.98483347371213, 49.129082862880004], [-122.98480603483466, 49.12907188528366], [-122.9847810838133, 49.12906484714865], [-122.98477859502452, 49.12906399395399]]]}}, {"id": "0", "type": "Feature", "properties": {"r": 0.5, "r_true": 0.4996416948349204, "Contour_Level": "50 % Flux Source Area Contour"}, "geometry": {"type": "Polygon", "coordinates": [[[-122.98488831544881, 49.12922345158831], [-122.98486087475537, 49.12921814384796], [-122.98483343257924, 49.12921771626923], [-122.98480598898719, 49.12922192386459], [-122.98479075704259, 49.129226927959664], [-122.9847785440254, 49.12923059075773], [-122.984751097314, 49.12924493156562], [-122.984751097314, 49.12924493156562], [-122.98472568131122, 49.12926293704312], [-122.98472364897731, 49.129264510959636], [-122.98470423221734, 49.12928094304058], [-122.98469619893297, 49.12928956840855], [-122.98468693368928, 49.12929894958454], [-122.98467408464352, 49.129316956716536], [-122.98466874423015, 49.12932964462895], [-122.9846657135716, 49.12933496444188], [-122.98466080586606, 49.12935297262674], [-122.98466150907065, 49.12937098155685], [-122.98466872595789, 49.12938890582709], [-122.98466875587985, 49.129388991355995], [-122.98468271758003, 49.12940700204564], [-122.98469616004223, 49.12941592629451], [-122.98471439727443, 49.12942501508057], [-122.9847235986249, 49.12942840235046], [-122.98475103892973, 49.12943530788306], [-122.98477848047231, 49.12943819487999], [-122.9848059229604, 49.129437998270824], [-122.98483336643734, 49.129434559108994], [-122.98486081166523, 49.1294253565723], [-122.9848614487993, 49.12942503445502], [-122.98488825826196, 49.1294116167975], [-122.98489216753876, 49.129407029642124], [-122.98489877248987, 49.12938902166962], [-122.98488845593936, 49.12937101148319], [-122.9848882706395, 49.12937089038796], [-122.98488322014563, 49.12935300196109], [-122.98488233564302, 49.12933499300854], [-122.98488828276989, 49.129330977135865], [-122.98491363648202, 49.12931698826587], [-122.98491573002214, 49.129314879707906], [-122.98492175389322, 49.12931698932623], [-122.98492344864096, 49.12933499838436], [-122.98492268145263, 49.129353007120926], [-122.98492660997422, 49.129371016470564], [-122.98494287901148, 49.12938902743], [-122.98494314986047, 49.129389253837665], [-122.98497058711698, 49.12940627365993], [-122.98497658723244, 49.129407040657576], [-122.98499802766793, 49.12941243660118], [-122.98502547021712, 49.12941198686218], [-122.98505259391514, 49.12940705052245], [-122.98505291413494, 49.129406982767954], [-122.9850803592981, 49.12939780990128], [-122.98509785653745, 49.129389047536726], [-122.98510780714297, 49.129379649260486], [-122.9851170276926, 49.12937104117289], [-122.98512366384055, 49.12935303319142], [-122.98511991902618, 49.12933502387211], [-122.98510782484759, 49.12932053611947], [-122.9851053008418, 49.12931701315043], [-122.98508038852347, 49.129300409954176], [-122.98507801708277, 49.12929900079063], [-122.98505294963336, 49.129288893788065], [-122.98502550911404, 49.129282829595915], [-122.98499806726115, 49.12928120765332], [-122.9849835895723, 49.129280979711254], [-122.98497062516664, 49.12928039101418], [-122.98495435270047, 49.12926296706807], [-122.98494319116631, 49.129252847468], [-122.98493281481315, 49.129244955422394], [-122.98491575477064, 49.12923329989513], [-122.98489657128466, 49.12922694184992], [-122.98488831544881, 49.12922345158831]]]}}]}
    
    var EC_Station = {"type": "FeatureCollection", "features": [{"id": "1", "type": "Feature", "properties": {"name": "BB", "Zm": 1.8, "lat": 49.129344, "lon": -122.984902, "canopy_height": 0.3}, "geometry": {"type": "Point", "coordinates": [-122.984902, 49.129344]}}]}

    map.on('load', () => {
        // Add a data sources containing GeoJSON data.

        // Add a data source containing GeoJSON data.
        map.addSource('Site_Name', {
            'type': 'geojson',
            'data': {"type": "FeatureCollection", "features": [{"id": "1", "type": "Feature", "properties": {"name": "BB", "Zm": 1.8, "lat": 49.129344, "lon": -122.984902, "canopy_height": 0.3}, "geometry": {"type": "Point", "coordinates": [-122.984902, 49.129344]}}]}
        });

        map.addSource('FP_Contour_Levels', {
            'type': 'geojson',
            'data': FP_Contour_Levels
        });

        // Add a new layer to visualize the polygon.
        map.addLayer({
            'id': 'FP_Contour_Levels',
            'type': 'fill',
            'source': 'FP_Contour_Levels', // reference the data source
            'layout': {},
            'paint': {
                'fill-color': '#f76605', // blue color fill
                'fill-opacity': 0.15
                }
            });
        // Add a black outline around the polygon.
        map.addLayer({
            'id': 'outline',
            'type': 'line',
            'source': 'FP_Contour_Levels',
            'layout': {},
            'paint': {
                'line-color': '#000',
                'line-width': 3
                }
            });

        
        map.addLayer({'id': 'Site_Name',
                'type': 'circle',
                'source': 'Site_Name',
                'filter': ['==', '$type', 'Point'],
                'paint': {
                    'circle-radius': 10,
                    'circle-color': '#9803fc',
                    "circle-stroke-width": 1,
                    "circle-stroke-color": 'black'
                    },
                });

    });

    map.on('click', 'FP_Contour_Levels', (e) => {
        new mapboxgl.Popup()
            .setLngLat(e.lngLat)
            .setHTML(e.features[0].properties.Contour_Level)
            .addTo(map);
        });

        
    let bbox = turf.extent(FP_Contour_Levels);
    
    // fit zom to the bounding box of whichever layers are loaded
    function fit() {
        map.fitBounds(bbox, {maxZoom: 18});
        };

    fit();

    map.addControl(new mapboxgl.ScaleControl({position: 'bottom-right'}));
    
    // Call fit when clicking the zoomto button
    document.getElementById('zoomto').addEventListener('click', () => {
        fit()
    });
</script>

</body>
</html>