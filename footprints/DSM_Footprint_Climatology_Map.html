<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Add a polygon to a map using a GeoJSON source</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
<link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
<!-- Import Turf Module - Needed to calculate bounding boxes -->
<script src='https://api.mapbox.com/mapbox.js/plugins/turf/v2.0.2/turf.min.js'></script>
<style>
    body { margin: 0; padding: 0; }
    #map { position: absolute; top: 0; bottom: 0; width: 100%; }

    /* Control the zoom to button */
    .btn-control {
        font: bold 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
        background-color: #3386c0;
        color: #fff;
        position: absolute;
        top: 20px;
        left: 50%;
        z-index: 1;
        border: none;
        width: 200px;
        margin-left: -100px;
        display: block;
        cursor: pointer;
        padding: 10px 20px;
        border-radius: 3px;
    }
    .btn-control:hover {
        background-color: #4ea0da;
    }
</style>
</head>
<body>
<button id="zoomto" class="btn-control">Zoom to Footprint</button>
<div id="map"></div>
<script>
	// Replace access token!
    mapboxgl.accessToken = 'pk.eyJ1IjoidWJjbWljcm9tZXQiLCJhIjoiY2xmMnJzYzlnMGFsYTNxcW1kYWhubjBiaSJ9.rhIOVatxQoS4M__qIFv6Pg';
  
    //  Custom mapStyle lest us use ESRI raster tiles
    const mapStyle = {
        version: 8,
        sources: {
        worldImagery: {
            type: "raster",
            tiles: ["https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"],
            tileSize: 256
            }
        },
        layers: [{
            id: "worldImagery",
            type: "raster",
            source: "worldImagery",
            minzoom: 0,
            maxzoom: 22
            }
        ]
    };

    //  Create the map - zoom and center are "arbitrary"
    const map = new mapboxgl.Map({
                container: 'map',
                zoom: 10,
                center: [-122.895226, 49.088835], // starting position
                style: mapStyle,
                });

    //  Locate the user
    var geolocate = new mapboxgl.GeolocateControl({
        positionOptions: {
        enableHighAccuracy: true
        },
        trackUserLocation: true,
        showUserHeading: true},);

    map.addControl(geolocate);
    map.addControl(new mapboxgl.NavigationControl());  

    var FP_Contour_Levels = {"type": "FeatureCollection", "features": [{"id": "2", "type": "Feature", "properties": {"r": 0.9, "r_true": 0.8999977613927438, "Contour_Level": "90 % Flux Source Area Contour"}, "geometry": {"type": "Polygon", "coordinates": [[[-122.8949955701605, 49.08758279446353], [-122.89496816461235, 49.087576245801785], [-122.89494074636217, 49.08757572110355], [-122.89491331797952, 49.087579998039864], [-122.89490201025305, 49.087583082067745], [-122.89488588304133, 49.08758737835727], [-122.89485844500267, 49.08759622323494], [-122.8948437445762, 49.08760103797645], [-122.89483100694208, 49.08760507386193], [-122.89480357077474, 49.08761302369736], [-122.89478027185358, 49.08761898910953], [-122.89477613661776, 49.08762001797302], [-122.89474870411321, 49.08762622682668], [-122.89472127095266, 49.087632742723926], [-122.89470651460067, 49.08763693082708], [-122.89469383488805, 49.08764062846191], [-122.89466639252915, 49.08765148570712], [-122.89466011948504, 49.087654897470095], [-122.89463893894634, 49.08766764198717], [-122.89463257403472, 49.08767288130177], [-122.89461368867737, 49.08769087303343], [-122.89461146519722, 49.08769331844174], [-122.89460038845996, 49.087708869861714], [-122.8945900098974, 49.087726869356366], [-122.89458394722973, 49.08773986924966], [-122.89458199000434, 49.08774487100407], [-122.8945760542368, 49.08776287455459], [-122.89457144762773, 49.08778087931869], [-122.89456798359781, 49.08779888512613], [-122.89456550576244, 49.08781689183418], [-122.89456388302591, 49.087834899323155], [-122.89456300560518, 49.08785290749283], [-122.89456278179753, 49.08787091625945], [-122.89456313534778, 49.08788892555337], [-122.89456400330401, 49.087906935317065], [-122.89456533427426, 49.08792494550362], [-122.89456708701688, 49.08794295607533], [-122.89456922931164, 49.08796096700275], [-122.8945717370712, 49.08797897826386], [-122.8945745936616, 49.08799698984344], [-122.89457778940856, 49.088015001732636], [-122.8945813212714, 49.08803301392862], [-122.8945833072333, 49.08804218613902], [-122.89458499344829, 49.0880510262526], [-122.89458869137324, 49.088069038599926], [-122.89459259592319, 49.08808705113574], [-122.89459670482883, 49.08810506385795], [-122.8946010168557, 49.08812307676543], [-122.89460552998291, 49.0881410898563], [-122.89461023855802, 49.08815910312538], [-122.89461047748836, 49.08816000569514], [-122.89461428441753, 49.08817711578918], [-122.8946182437839, 49.08819512837384], [-122.89462208115737, 49.08821314084692], [-122.89462567680827, 49.08823115309916], [-122.89462883648785, 49.08824916495327], [-122.89463123941519, 49.088267176116496], [-122.89463234456285, 49.08828518609501], [-122.89463121594112, 49.08830319403448], [-122.89462618500512, 49.088321198411734], [-122.89461417549421, 49.088339196417884], [-122.8946100908284, 49.08834269721187], [-122.89458264837566, 49.08835340727436], [-122.89455522195485, 49.08835654087798], [-122.89452780259292, 49.08835634023707], [-122.89450038645283, 49.0883546190258], [-122.89447297168441, 49.08835225145671], [-122.89444555729598, 49.08834970585685], [-122.89441814268984, 49.0883472642574], [-122.8943907274474, 49.08834512393221], [-122.89436331121627, 49.08834345076631], [-122.89433589363911, 49.08834241280047], [-122.8943084742962, 49.08834220727442], [-122.89428105264481, 49.08834308918309], [-122.89425362793985, 49.0883454085335], [-122.89422619911548, 49.08834966596327], [-122.89419876459225, 49.088356603340635], [-122.89419810246635, 49.088356824784555], [-122.89417131828917, 49.0883690798166], [-122.89416232136999, 49.088374800953254], [-122.89414486167101, 49.08839279391324], [-122.89414384400663, 49.08839471141301], [-122.8941365128247, 49.08841079522631], [-122.89413360968973, 49.088428801533176], [-122.89413436110586, 49.08844681119157], [-122.89413762267348, 49.088464823151945], [-122.89414257999506, 49.08848283666723], [-122.89414364998373, 49.08848597992254], [-122.89414823550852, 49.088500850822484], [-122.89415407373806, 49.088518865144934], [-122.89415949821101, 49.088536879087684], [-122.89416371832559, 49.08855489192588], [-122.89416575343093, 49.088572902760625], [-122.89416443065926, 49.088590910516686], [-122.89415848897762, 49.088608914037685], [-122.89414684142409, 49.088626912326234], [-122.89414334292002, 49.088630421978046], [-122.89412731496483, 49.08864490338757], [-122.89411587574138, 49.08865263810856], [-122.89409944784886, 49.088662886794076], [-122.89408842194233, 49.08866855229576], [-122.89406324352751, 49.088680862542894], [-122.8940609737113, 49.088681841083776], [-122.89403352963248, 49.088693171834116], [-122.89401957941818, 49.08869883143174], [-122.89400608671605, 49.08870395064948], [-122.89397864463102, 49.08871433339164], [-122.89397204079194, 49.0887167967453], [-122.89395120322862, 49.08872439023388], [-122.8939237613454, 49.08873466757984], [-122.8939235073375, 49.088734761125075], [-122.89389631960577, 49.08874487222846], [-122.89387591730427, 49.08875272635172], [-122.89386887689255, 49.088755528366164], [-122.89384143339929, 49.088766544882354], [-122.89383126087344, 49.08877069425686], [-122.89381398867688, 49.08877813208906], [-122.89379019019067, 49.08878866544391], [-122.89378654249505, 49.08879039750111], [-122.89375909454061, 49.088803487386436], [-122.89375255752901, 49.088806639780735], [-122.893731644371, 49.08881760846033], [-122.89371844032658, 49.08882461734199], [-122.89370419160426, 49.08883293886049], [-122.89368771449429, 49.08884259801654], [-122.89367673565576, 49.08884975143597], [-122.89366004596462, 49.088860581499304], [-122.8936492757239, 49.08886842037232], [-122.89363517434239, 49.08887856755258], [-122.89362181074263, 49.08888944321082], [-122.89361291129917, 49.08889655600457], [-122.89359433930824, 49.0889134750155], [-122.89359313406297, 49.088914546743645], [-122.8935752258631, 49.088932539202446], [-122.89356685760374, 49.088942299209485], [-122.8935595360762, 49.08895053370398], [-122.89354578807536, 49.08896852999408], [-122.89353936006442, 49.08897851478145], [-122.89353395137171, 49.088986528045275], [-122.89352391863817, 49.08900452775919], [-122.89351600143068, 49.08902252942367], [-122.8935118179962, 49.08903553333996], [-122.89351010392956, 49.089040532950804], [-122.89350631026656, 49.089058538418456], [-122.8935050583139, 49.08907654623082], [-122.89350667528238, 49.08909455668984], [-122.89351165324604, 49.08911257024931], [-122.89351165324604, 49.08911257024931], [-122.8935203526907, 49.08913058724136], [-122.89353402939786, 49.08914860882334], [-122.89353898628386, 49.0891533390715], [-122.89355371407812, 49.08916663594393], [-122.893566359739, 49.08917522010888], [-122.89358147501513, 49.08918467050682], [-122.89359374670421, 49.08919079026629], [-122.89362055573764, 49.08920271549527], [-122.89362114100929, 49.0892029328111], [-122.89364854106964, 49.089212387000536], [-122.8936759441282, 49.089220441948726], [-122.89367718782145, 49.08922077663766], [-122.89370335042005, 49.08922698644805], [-122.89373075876213, 49.08923257366267], [-122.89375816889006, 49.089237326768576], [-122.89376826953138, 49.08923886946033], [-122.89378558065195, 49.08924131632762], [-122.89381299376316, 49.08924467521051], [-122.89384040804563, 49.08924748646214], [-122.89386782338694, 49.08924980238634], [-122.89389523968818, 49.089251669029885], [-122.89392265686237, 49.089253126863596], [-122.89395007483333, 49.08925421135652], [-122.89397749353449, 49.0892549534568], [-122.89400491290822, 49.0892553799899], [-122.894032332905, 49.08925551398203], [-122.89405975348285, 49.08925537491438], [-122.89408717460708, 49.089254978911256], [-122.89411459624984, 49.08925433886329], [-122.89414201839006, 49.08925346448401], [-122.89416944101349, 49.08925236229555], [-122.89419686411289, 49.08925103553581], [-122.89422428768835, 49.08924948397549], [-122.894251711748, 49.08924770362792], [-122.89427913630877, 49.08924568632767], [-122.89430656139771, 49.089243419144644], [-122.8943339870537, 49.08924088358707], [-122.89434829328307, 49.089239401782585], [-122.89436141291058, 49.089238252004826], [-122.89438883880777, 49.08923560005419], [-122.89441626522948, 49.08923269936], [-122.89444369224421, 49.08922951741654], [-122.89447111994163, 49.089226011692254], [-122.89449854843853, 49.08922212681542], [-122.8945023502921, 49.08922153371326], [-122.89452597635034, 49.08921851612939], [-122.89455340474116, 49.089214677362115], [-122.89458083399508, 49.08921042891808], [-122.89460826431657, 49.08920567388368], [-122.89461889257105, 49.089203631197066], [-122.89463569435748, 49.08920104897194], [-122.8946631244634, 49.08919639091706], [-122.89469055586102, 49.089191119676144], [-122.89471512313503, 49.08918571003929], [-122.89471798859226, 49.08918521493775], [-122.8947454198122, 49.089180022094745], [-122.89477285275353, 49.08917401197737], [-122.89479708000182, 49.08916777579366], [-122.89480028750887, 49.08916714009294], [-122.89482772036897, 49.089161161946215], [-122.89485515558334, 49.0891540657332], [-122.89486971772533, 49.089149833002935], [-122.8948825907527, 49.08914698715582], [-122.89491002446798, 49.08914059384671], [-122.89493745850926, 49.089134042676164], [-122.89495067448333, 49.089131897737325], [-122.89496488689007, 49.08913017153401], [-122.89499230626308, 49.089130569786555], [-122.89499833224399, 49.08913194109745], [-122.8950197063728, 49.08914010507538], [-122.89503386745531, 49.08914998238238], [-122.89504708102771, 49.08916172207295], [-122.89505309178625, 49.089168008828565], [-122.89506955045016, 49.089186032757524], [-122.89507443866735, 49.08919142512556], [-122.89508608899426, 49.08920405675668], [-122.89510179919249, 49.08921977394863], [-122.89510429173811, 49.08922208226568], [-122.89512388572467, 49.089240109035735], [-122.89512916666314, 49.08924483976446], [-122.89514552689239, 49.08925813766196], [-122.89515654035016, 49.08926696631941], [-122.89516936861962, 49.08927616828248], [-122.89518391900552, 49.08928674417537], [-122.89519548306949, 49.08929420096148], [-122.89521130143115, 49.08930474081939], [-122.89522405198015, 49.08931223586235], [-122.89523868700103, 49.08932125239353], [-122.89525534402638, 49.089330273227056], [-122.89526607539887, 49.089336428119516], [-122.89528970292666, 49.089348313365186], [-122.89529346648419, 49.08935033372236], [-122.89532085931222, 49.08936341765324], [-122.8953278859925, 49.08936635696068], [-122.89534825405578, 49.08937559701631], [-122.89537064170332, 49.08938440468818], [-122.89537565139375, 49.08938654801761], [-122.89540304996828, 49.08939691608752], [-122.89541996050377, 49.089402458345866], [-122.89543045076687, 49.08940623054839], [-122.89545785311648, 49.08941481114423], [-122.89547907765657, 49.089420520854766], [-122.89548525765014, 49.08942235570344], [-122.89551266341078, 49.089429319503466], [-122.89554007150448, 49.089435174861634], [-122.89555957521111, 49.08943860267929], [-122.89556748145506, 49.089440147934425], [-122.89559489300548, 49.0894443606048], [-122.89562230681057, 49.089447499921725], [-122.89564972288503, 49.08944955799036], [-122.89567714132451, 49.08945048831687], [-122.89570456231083, 49.08945020322677], [-122.89573198612254, 49.089448568706445], [-122.89575941315229, 49.089445396155796], [-122.89578684393203, 49.08944043018006], [-122.89579349040201, 49.08943881407774], [-122.89581427872845, 49.089433541922716], [-122.89584171879602, 49.08942413013697], [-122.89584938628325, 49.08942085555688], [-122.89586916522396, 49.08941167201086], [-122.89588451017963, 49.089402878275735], [-122.89589662024747, 49.08939509599099], [-122.89591012322876, 49.089384892408155], [-122.89592408760856, 49.08937260853018], [-122.89592982015368, 49.08936690120133], [-122.89594529894872, 49.0893489061889], [-122.8959515759293, 49.089340078772516], [-122.89595760119222, 49.089330908311325], [-122.89596736230095, 49.08931290814231], [-122.89597490859109, 49.089294905976544], [-122.89597911810445, 49.08928175246474], [-122.8959806265058, 49.089276902162666], [-122.89598486800949, 49.089258897018105], [-122.89598764448108, 49.089240890553306], [-122.89598910084509, 49.089222882898916], [-122.89598934828767, 49.08920487415518], [-122.89598846754132, 49.08918686439486], [-122.89598651120427, 49.089168853665306], [-122.89598350552707, 49.08915084199012], [-122.89597945228601, 49.08913282937083], [-122.89597942937604, 49.08913275037539], [-122.89597488568914, 49.08911481628874], [-122.89596941574251, 49.08909680239231], [-122.89596302587891, 49.08907878766648], [-122.8959557128747, 49.0890607721082], [-122.89595217582365, 49.08905299185963], [-122.89594813686186, 49.08904275631231], [-122.89594045456782, 49.08902474042006], [-122.89593242859134, 49.08900672421741], [-122.89592488783963, 49.088989748549416], [-122.89592449267955, 49.08898870809536], [-122.89591825830445, 49.08897069350689], [-122.8959132033757, 49.08895267998152], [-122.89590999655465, 49.08893466812238], [-122.8959092721737, 49.08891665850159], [-122.89591148765324, 49.08889865153168], [-122.89591680218044, 49.088880647355985], [-122.89592502857636, 49.08886264580536], [-122.89592515392354, 49.08886244241507], [-122.8959379468297, 49.08884464848377], [-122.89595264829767, 49.0888268803048], [-122.89595286273189, 49.08882665296129], [-122.8959717358079, 49.08880866100304], [-122.89598012267768, 49.08880087055163], [-122.89599223236267, 49.08879067050444], [-122.8960075914634, 49.08877752572644], [-122.89601373784625, 49.088772680911006], [-122.89603505842494, 49.08875504225373], [-122.89603551436095, 49.08875469155761], [-122.89605760126341, 49.088736702479544], [-122.89606252593168, 49.08873228569264], [-122.89607883953703, 49.08871871263321], [-122.89608999591329, 49.08870833111387], [-122.89609881659808, 49.08870072164773], [-122.89611729123037, 49.08868272930669], [-122.8961174697135, 49.08868253346831], [-122.89613513908319, 49.08866473639868], [-122.89614495057172, 49.088653338124814], [-122.89615114513447, 49.088646741830914], [-122.89616581655825, 49.08862874606037], [-122.8961724416224, 49.08861923912516], [-122.89617894771196, 49.08861074890263], [-122.89619056395223, 49.088592750381], [-122.89619995344563, 49.08857515710855], [-122.89620019378512, 49.08857475007198], [-122.8962084843364, 49.088556748557906], [-122.89621461048506, 49.08853874509723], [-122.8962184883945, 49.08852073961491], [-122.89621990846582, 49.08850273192274], [-122.89621850883762, 49.088484721695494], [-122.89621373077271, 49.088466708430694], [-122.89620474675077, 49.08844869138385], [-122.89620022977601, 49.08844259629684], [-122.89619049185801, 49.08843066959632], [-122.89617286616922, 49.08841563003494], [-122.89616883090264, 49.08841264114562], [-122.89614548058191, 49.088399216929716], [-122.89613569240805, 49.08839460236424], [-122.8961180848297, 49.088387684928406], [-122.8960906827208, 49.08837920523549], [-122.89607979359722, 49.08837654308553], [-122.89606327602998, 49.088372925166816], [-122.89603586590317, 49.08836829410281], [-122.89600845303737, 49.08836497701721], [-122.89598103795096, 49.088362724711494], [-122.8959536211126, 49.088361312044306], [-122.8959262029943, 49.08836051251208], [-122.89589878413896, 49.088360065954845], [-122.89587136525971, 49.08835963106266], [-122.89584394740481, 49.088358706684126], [-122.8958391109994, 49.08835831719045], [-122.89581653279515, 49.08835623169484], [-122.895789125081, 49.08835046315727], [-122.8957660407231, 49.08834024226395], [-122.89576173208376, 49.08833766730165], [-122.89574746229732, 49.08832221651722], [-122.8957365552352, 49.08830419769669], [-122.8957343936863, 49.08829880245667], [-122.895730986158, 49.08828618369683], [-122.89572778752515, 49.0882681718379], [-122.89572580411988, 49.088250161076566], [-122.8957246665423, 49.08823215107921], [-122.89572410566373, 49.08821414160275], [-122.89572392106395, 49.08819613246612], [-122.89572395886935, 49.088178123530334], [-122.89572409604807, 49.08816011468428], [-122.89572422902637, 49.088142105834365], [-122.8957242651129, 49.088124096896856], [-122.89572411564818, 49.0881060877917], [-122.89572369007416, 49.088088078437046], [-122.89572289027066, 49.088070068744294], [-122.89572160456207, 49.08805205861252], [-122.89571970075707, 49.088034047922314], [-122.89571701743745, 49.08801603652781], [-122.89571335241872, 49.087998024246296], [-122.8957084467807, 49.08798001084376], [-122.89570764671271, 49.08797757754235], [-122.89570071196168, 49.08796199488472], [-122.89568965131429, 49.08794397591982], [-122.8956803215918, 49.08793248958872], [-122.89566988566744, 49.08792594908651], [-122.89565293332716, 49.087917558261495], [-122.89562551724656, 49.087915905422356], [-122.89559808410476, 49.08792239099737], [-122.89559081360706, 49.087925877593754], [-122.8955706391864, 49.0879344886631], [-122.89555559679755, 49.08794385470589], [-122.89554318523807, 49.087950884659016], [-122.89552836537466, 49.087961839034534], [-122.89551572447166, 49.087970521413574], [-122.89550447881454, 49.08797982638462], [-122.89548825865153, 49.087992555767926], [-122.89548227582293, 49.08799781525407], [-122.89546109076925, 49.088015805041074], [-122.89546078974685, 49.088016047781636], [-122.89543981310528, 49.08803379474024], [-122.89543332165368, 49.0880391410008], [-122.89541683531004, 49.08805178289515], [-122.89540585815747, 49.08806003355056], [-122.89538843115065, 49.08806976612796], [-122.89537840666122, 49.08807520365228], [-122.89535097778439, 49.08807960270578], [-122.89532724389957, 49.08806971066129], [-122.89532358245238, 49.08806804190295], [-122.89530907933471, 49.08805168521838], [-122.89529622782145, 49.0880371303037], [-122.89529422476238, 49.08803366277496], [-122.89528403525544, 49.08801564456157], [-122.89527350801642, 49.08799762604081], [-122.89526890790893, 49.08798972757053], [-122.8952642009861, 49.087979608626156], [-122.89525572258958, 49.08796159196261], [-122.89524689468215, 49.087943574981196], [-122.89524160780711, 49.0879329327322], [-122.89523832790344, 49.08792555823602], [-122.89523028209508, 49.08790754196302], [-122.8952218952579, 49.08788952537985], [-122.89521431274503, 49.08787377246313], [-122.89521325648249, 49.087871508567304], [-122.89520496481488, 49.087853492069165], [-122.89519634614908, 49.0878354752735], [-122.89518738774989, 49.08781745816865], [-122.89518701336753, 49.087816693180045], [-122.89517833156856, 49.08779944097427], [-122.89516897800343, 49.08778142350905], [-122.89515970457904, 49.087764113514446], [-122.8951592916287, 49.08776340574075], [-122.89514899648698, 49.087745387418614], [-122.89513842515265, 49.08772736884461], [-122.8951323840493, 49.087717136492664], [-122.8951271183466, 49.08770934960141], [-122.8951150089437, 49.0876913296278], [-122.89510504986751, 49.087676664875325], [-122.89510228573565, 49.08767330909507], [-122.89508776331091, 49.08765528692567], [-122.89507770188345, 49.087642764895406], [-122.89507198443727, 49.087637263612315], [-122.89505372341588, 49.08761923804014], [-122.8950503393056, 49.08761580699699], [-122.89503017767434, 49.087601207659496], [-122.89502296216163, 49.08759577265608], [-122.89499631634196, 49.087583167890955], [-122.8949955701605, 49.08758279446353]]]}}, {"id": "1", "type": "Feature", "properties": {"r": 0.75, "r_true": 0.7499962379541859, "Contour_Level": "75 % Flux Source Area Contour"}, "geometry": {"type": "Polygon", "coordinates": [[[-122.89513108889815, 49.08833212537621], [-122.89510368027855, 49.088326830600174], [-122.89507625737836, 49.08832831591944], [-122.89504881977199, 49.08833677793361], [-122.8950435196352, 49.08833958758831], [-122.89502136749164, 49.088352195911646], [-122.89501459798475, 49.08835757025776], [-122.8949947330323, 49.08837556115871], [-122.89499389665163, 49.088376406995344], [-122.89497988825384, 49.08839355662356], [-122.89496825207068, 49.08841155500592], [-122.89496639574085, 49.08841486153474], [-122.89495892770968, 49.08842955549075], [-122.89495142961756, 49.08844755763673], [-122.89494541443007, 49.088465561131756], [-122.89494054106197, 49.08848356566559], [-122.89493881562814, 49.08849083447839], [-122.8949360740243, 49.088501570568994], [-122.89493172651886, 49.08851957558097], [-122.89492742935461, 49.08853758063856], [-122.89492280365036, 49.088555585396854], [-122.89491738910887, 49.08857358943682], [-122.8949111864093, 49.08859003558911], [-122.8949103419124, 49.08859159199015], [-122.89489714337026, 49.08860958894239], [-122.89488369623221, 49.088623319195214], [-122.8948776073917, 49.088627580121965], [-122.89485624098165, 49.08864004471031], [-122.8948450218505, 49.08864555941147], [-122.89482879347828, 49.088653093491644], [-122.89480762528785, 49.08866353430766], [-122.89480134470011, 49.08866673887893], [-122.89477594852376, 49.08868151440569], [-122.89477389078108, 49.088682809855285], [-122.89474979258314, 49.088699499528836], [-122.8947464301887, 49.0887020295582], [-122.89472664969267, 49.08871748739386], [-122.89471896397914, 49.088723895933306], [-122.89470494532331, 49.08873547656637], [-122.89469149484097, 49.088747135691506], [-122.89468389016584, 49.088753466327034], [-122.89466402474635, 49.08877081543282], [-122.89466324671005, 49.08877145645952], [-122.894642225012, 49.088789446243005], [-122.89463655384121, 49.08879486587344], [-122.89462229870932, 49.088807437022595], [-122.89460907832681, 49.08882108151134], [-122.89460447928059, 49.08882542972235], [-122.8945886597773, 49.08884342424559], [-122.89458158844738, 49.08885406874303], [-122.89457611251333, 49.088861421755084], [-122.89456689353115, 49.08887942230313], [-122.89456205926237, 49.08889742685544], [-122.8945618343131, 49.088915435617736], [-122.89456692385414, 49.08893344923412], [-122.89457874978355, 49.08895146900243], [-122.89458137689127, 49.08895399648215], [-122.89459818098379, 49.088969495713975], [-122.8946087501358, 49.088976141681485], [-122.89462899982702, 49.08898753281757], [-122.89463613961284, 49.08899062705273], [-122.8946635375938, 49.08900110004078], [-122.89467773271109, 49.089005586258935], [-122.89469094063593, 49.089009185373804], [-122.89471834748882, 49.08901547258714], [-122.89474575750907, 49.08902026466044], [-122.8947722907826, 49.08902368146185], [-122.89477317020602, 49.089023792594304], [-122.89480058449027, 49.08902657104466], [-122.89482800081691, 49.0890283839807], [-122.89485541901762, 49.08902931033493], [-122.89488283899749, 49.089029394407746], [-122.8949102607526, 49.089028637359384], [-122.89493768439499, 49.08902698544992], [-122.89496511011086, 49.089024349701816], [-122.89496900643982, 49.08902386061532], [-122.89499253558841, 49.08902182557299], [-122.89501996056639, 49.08901953709543], [-122.8950473835979, 49.08901817090154], [-122.8950748031, 49.0890184789201], [-122.89510221893612, 49.089020527309664], [-122.89512944015772, 49.0890240064778], [-122.89512963167657, 49.08902404662245], [-122.89515703651429, 49.089031321080256], [-122.89518444003537, 49.089039224827495], [-122.89519553008246, 49.08904207546766], [-122.89521184309343, 49.089047352727135], [-122.89523925037501, 49.0890534773908], [-122.89526666303998, 49.08905704581681], [-122.89529408001576, 49.08905856605531], [-122.89532150091107, 49.089058222646955], [-122.89534892591274, 49.08905592522602], [-122.89537635569293, 49.08905135232953], [-122.89540379143119, 49.089043940662854], [-122.89540851288612, 49.08904226864007], [-122.89543123241882, 49.08903402544152], [-122.89545076453595, 49.0890242979477], [-122.8954586820874, 49.08901997021479], [-122.8954788846295, 49.08900631444523], [-122.89548614300878, 49.08900054638006], [-122.89549991193569, 49.08898832451517], [-122.89551361699988, 49.08897488385728], [-122.89551805974553, 49.08897033197499], [-122.89553631149258, 49.08895233952596], [-122.89554109416211, 49.08894769618078], [-122.89555398094797, 49.08893434654713], [-122.89556858001417, 49.08891635078786], [-122.89556858001417, 49.08891635078786], [-122.89558179587017, 49.08889835377551], [-122.89559107026055, 49.08888035319668], [-122.89559610698421, 49.088865378168734], [-122.89559732339005, 49.088862349884565], [-122.89560159440997, 49.088844344779474], [-122.89560270741882, 49.08882633681815], [-122.89560078883633, 49.08880832611504], [-122.89559626258739, 49.088791165066425], [-122.89559606308762, 49.08879031287297], [-122.89559045612323, 49.088772298833604], [-122.89558443129262, 49.08875428441593], [-122.89557885673631, 49.088736270405185], [-122.89557120613138, 49.08871825451603], [-122.89556900276733, 49.08871477642126], [-122.89556006904996, 49.088700235471975], [-122.8955440679179, 49.08868221202545], [-122.8955416559827, 49.08867988289733], [-122.89552793054466, 49.088664188453336], [-122.8955143001586, 49.08864931553419], [-122.89551221637156, 49.08864616526198], [-122.89550107404447, 49.088628146207235], [-122.89549031024781, 49.08861012749407], [-122.89548697475396, 49.088604271014965], [-122.89548152373935, 49.088592110570175], [-122.89547280564435, 49.088574093707486], [-122.8954627490903, 49.08855607563199], [-122.89545966671793, 49.08855097698668], [-122.89545132115373, 49.08853805631352], [-122.89543653066708, 49.08852003394803], [-122.89543232113118, 49.08851559225854], [-122.89541395580504, 49.088502004528046], [-122.89540494167815, 49.08849634880715], [-122.89537754323027, 49.08848615598338], [-122.89536912697247, 49.088483954934574], [-122.89535013852972, 49.08847894364711], [-122.89532273710107, 49.08847017864443], [-122.89531430462573, 49.088465896261134], [-122.89529534723205, 49.088455920759614], [-122.89528454678096, 49.08844786030132], [-122.8952679705826, 49.08843538509006], [-122.89526179320103, 49.088429830689215], [-122.89524172944459, 49.08841180351365], [-122.89524060255937, 49.08841075987783], [-122.89522260803898, 49.088393777189886], [-122.89521323702137, 49.08838496653458], [-122.89520197404738, 49.08837574948969], [-122.89518586515892, 49.08836219124612], [-122.89517871283446, 49.08835771940012], [-122.89515848333248, 49.0883441602925], [-122.89514757336464, 49.08833968215003], [-122.89513108889815, 49.08833212537621]]]}}, {"id": "0", "type": "Feature", "properties": {"r": 0.5, "r_true": 0.5001410800656734, "Contour_Level": "50 % Flux Source Area Contour"}, "geometry": {"type": "Polygon", "coordinates": [[[-122.89518535386416, 49.088605095012184], [-122.89515792986855, 49.08860702898182], [-122.89515081183885, 49.088609819627635], [-122.89513048666922, 49.088618080302936], [-122.89511787906572, 49.08862779867879], [-122.89510301675455, 49.088641807595614], [-122.89509962610461, 49.088645791061595], [-122.89508604289868, 49.08866378768569], [-122.89507590160629, 49.08868178743669], [-122.89507551100495, 49.08868252879189], [-122.8950648337655, 49.088699786344485], [-122.89505377962264, 49.088717785263626], [-122.89504800057182, 49.08872545070936], [-122.89503718703713, 49.08873577914577], [-122.89502053141051, 49.0887487738832], [-122.89501281283253, 49.08875376594842], [-122.89499307353051, 49.088766735247944], [-122.89498539200734, 49.088771749974306], [-122.89496560729992, 49.088788646020035], [-122.89496430151765, 49.088789739753864], [-122.89494881609068, 49.08880773463049], [-122.89494063436806, 49.08882573615246], [-122.8949380762471, 49.0888412678971], [-122.89493753606996, 49.088843742300575], [-122.89493806249833, 49.08884778413528], [-122.89493953975914, 49.088861753092104], [-122.8949475564864, 49.088879769355906], [-122.8949653770648, 49.08889779454007], [-122.8949653770648, 49.08889779454007], [-122.89499276209715, 49.08891441634104], [-122.89499569981324, 49.08891583109457], [-122.89502016019624, 49.088924848980106], [-122.89504756713006, 49.08893109547919], [-122.89507357631557, 49.08893391087557], [-122.89507498096846, 49.08893406855238], [-122.89510239858323, 49.088935250579], [-122.89512981652305, 49.08893627886368], [-122.8951572401428, 49.08893461008329], [-122.89515958922331, 49.08893398902628], [-122.8951846735216, 49.0889283042424], [-122.89520508737283, 49.08891602137199], [-122.89521186910397, 49.088898018560734], [-122.89520572251644, 49.08888000401312], [-122.89520390875195, 49.08886199339871], [-122.89520303876074, 49.08884398364102], [-122.89520217829856, 49.08882597389191], [-122.89521231685305, 49.0888222277158], [-122.89523973935087, 49.088821061020845], [-122.89526715360869, 49.088823811337654], [-122.89527855193926, 49.088826043202594], [-122.89528691591329, 49.088844059757946], [-122.89527794707818, 49.08886206058968], [-122.89526705838709, 49.0888690834405], [-122.89524286649325, 49.08888003772723], [-122.89523960070542, 49.088886961244484], [-122.8952173368438, 49.08889802352404], [-122.89523956943427, 49.08890182485982], [-122.89526698952312, 49.08890182400802], [-122.8952782850037, 49.088898078831825], [-122.89529443191162, 49.08889121828307], [-122.89532187085791, 49.088882244403926], [-122.89534929056494, 49.088882420105485], [-122.89535815402824, 49.08888014229299], [-122.8953767292448, 49.088873566013675], [-122.89539232559966, 49.08886216429668], [-122.89539999751888, 49.08884416228089], [-122.89539363997326, 49.08882614755196], [-122.89537685123096, 49.088815508186144], [-122.89536260009584, 49.08880811045168], [-122.89535983276281, 49.08879009897514], [-122.89536091356577, 49.08877209098678], [-122.89535925279388, 49.08875408051316], [-122.89535453374607, 49.08873606726707], [-122.89534962142748, 49.08872499100124], [-122.89534718638151, 49.088718051637954], [-122.89533724336714, 49.0887000336549], [-122.89532228927409, 49.08868320795926], [-122.89532125559379, 49.08868201018959], [-122.89530228600864, 49.08866398401758], [-122.89529492186558, 49.088658212941695], [-122.89527833384997, 49.08864595332234], [-122.89526754335755, 49.08863850820212], [-122.8952491121629, 49.08862791784037], [-122.89524015706108, 49.08862251574914], [-122.895212761066, 49.08861114038799], [-122.8952057319746, 49.08860986949841], [-122.89518535386416, 49.088605095012184]]]}}]}
    
    var EC_Station = {"type": "FeatureCollection", "features": [{"id": "3", "type": "Feature", "properties": {"name": "DSM", "Zm": 1.83, "lat": 49.088835, "lon": -122.895226, "canopy_height": 0.16}, "geometry": {"type": "Point", "coordinates": [-122.895226, 49.088835]}}]}

    map.on('load', () => {
        // Add a data sources containing GeoJSON data.

        // Add a data source containing GeoJSON data.
        map.addSource('Site_Name', {
            'type': 'geojson',
            'data': {"type": "FeatureCollection", "features": [{"id": "3", "type": "Feature", "properties": {"name": "DSM", "Zm": 1.83, "lat": 49.088835, "lon": -122.895226, "canopy_height": 0.16}, "geometry": {"type": "Point", "coordinates": [-122.895226, 49.088835]}}]}
        });

        map.addSource('FP_Contour_Levels', {
            'type': 'geojson',
            'data': FP_Contour_Levels
        });

        // Add a new layer to visualize the polygon.
        map.addLayer({
            'id': 'FP_Contour_Levels',
            'type': 'fill',
            'source': 'FP_Contour_Levels', // reference the data source
            'layout': {},
            'paint': {
                'fill-color': '#f76605', // blue color fill
                'fill-opacity': 0.15
                }
            });
        // Add a black outline around the polygon.
        map.addLayer({
            'id': 'outline',
            'type': 'line',
            'source': 'FP_Contour_Levels',
            'layout': {},
            'paint': {
                'line-color': '#000',
                'line-width': 3
                }
            });

        
        map.addLayer({'id': 'Site_Name',
                'type': 'circle',
                'source': 'Site_Name',
                'filter': ['==', '$type', 'Point'],
                'paint': {
                    'circle-radius': 10,
                    'circle-color': '#9803fc',
                    "circle-stroke-width": 1,
                    "circle-stroke-color": 'black'
                    },
                });

    });

    map.on('click', 'FP_Contour_Levels', (e) => {
        new mapboxgl.Popup()
            .setLngLat(e.lngLat)
            .setHTML(e.features[0].properties.Contour_Level)
            .addTo(map);
        });

        
    let bbox = turf.extent(FP_Contour_Levels);
    
    // fit zom to the bounding box of whichever layers are loaded
    function fit() {
        map.fitBounds(bbox, {maxZoom: 18});
        };

    fit();

    map.addControl(new mapboxgl.ScaleControl({position: 'bottom-right'}));
    
    // Call fit when clicking the zoomto button
    document.getElementById('zoomto').addEventListener('click', () => {
        fit()
    });
</script>

</body>
</html>