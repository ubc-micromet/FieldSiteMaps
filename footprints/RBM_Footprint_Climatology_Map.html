<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Add a polygon to a map using a GeoJSON source</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
<link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
<!-- Import Turf Module - Needed to calculate bounding boxes -->
<script src='https://api.mapbox.com/mapbox.js/plugins/turf/v2.0.2/turf.min.js'></script>
<style>
    body { margin: 0; padding: 0; }
    #map { position: absolute; top: 0; bottom: 0; width: 100%; }

    /* Control the zoom to button */
    .btn-control {
        font: bold 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
        background-color: #3386c0;
        color: #fff;
        position: absolute;
        top: 20px;
        left: 50%;
        z-index: 1;
        border: none;
        width: 200px;
        margin-left: -100px;
        display: block;
        cursor: pointer;
        padding: 10px 20px;
        border-radius: 3px;
    }
    .btn-control:hover {
        background-color: #4ea0da;
    }
</style>
</head>
<body>
<button id="zoomto" class="btn-control">Zoom to Footprint</button>
<div id="map"></div>
<script>
	// Replace access token!
    mapboxgl.accessToken = 'pk.eyJ1IjoidWJjbWljcm9tZXQiLCJhIjoiY2xmMnJzYzlnMGFsYTNxcW1kYWhubjBiaSJ9.rhIOVatxQoS4M__qIFv6Pg';
  
    //  Custom mapStyle lest us use ESRI raster tiles
    const mapStyle = {
        version: 8,
        sources: {
        worldImagery: {
            type: "raster",
            tiles: ["https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"],
            tileSize: 256
            }
        },
        layers: [{
            id: "worldImagery",
            type: "raster",
            source: "worldImagery",
            minzoom: 0,
            maxzoom: 22
            }
        ]
    };

    //  Create the map - zoom and center are "arbitrary"
    const map = new mapboxgl.Map({
                container: 'map',
                zoom: 10,
                center: [-123.196356, 49.131267], // starting position
                style: mapStyle,
                });

    //  Locate the user
    var geolocate = new mapboxgl.GeolocateControl({
        positionOptions: {
        enableHighAccuracy: true
        },
        trackUserLocation: true,
        showUserHeading: true},);

    map.addControl(geolocate);
    map.addControl(new mapboxgl.NavigationControl());  

    var FP_Contour_Levels = {"type": "FeatureCollection", "features": [{"id": "2", "type": "Feature", "properties": {"r": 0.9, "r_true": 0.8999999111590357, "Contour_Level": "90 % Flux Source Area Contour"}, "geometry": {"type": "Polygon", "coordinates": [[[-123.19633930478999, 49.130517498383625], [-123.19631181884186, 49.13051359706256], [-123.19628433674319, 49.13051066975427], [-123.19625685826652, 49.13050865923103], [-123.19622938322375, 49.130507518230246], [-123.19620191145843, 49.130507207462365], [-123.19617444283774, 49.130507693621425], [-123.19614697724512, 49.13050894748244], [-123.19611951457323, 49.13051094217077], [-123.1960920547185, 49.13051365172181], [-123.19606459757689, 49.13051705006431], [-123.19604851283339, 49.13051940650832], [-123.19603714247987, 49.1305209679189], [-123.196009688915, 49.130525275523674], [-123.19598223757752, 49.13053014942556], [-123.19595478838218, 49.13053556821649], [-123.19594517654564, 49.130537608818535], [-123.19592733999285, 49.130541193070286], [-123.19589989282538, 49.13054712961739], [-123.19587244751698, 49.13055353973161], [-123.19586332711948, 49.130555774588245], [-123.19584500257834, 49.13056004551807], [-123.19581755868198, 49.13056681776917], [-123.19579056582029, 49.130573924889], [-123.19579011654088, 49.13057403766471], [-123.19576267385614, 49.130581121498935], [-123.19573523296395, 49.13058866267021], [-123.19572331881183, 49.13059206579631], [-123.19570779246621, 49.13059630615592], [-123.19568035268192, 49.13060413307289], [-123.19566007630684, 49.13061019987835], [-123.19565291403366, 49.13061225086648], [-123.19562547523232, 49.13062033203834], [-123.1955997292424, 49.13062832902052], [-123.19559803807019, 49.13062883214963], [-123.19557060011076, 49.13063713194694], [-123.19554316393683, 49.13064588806609], [-123.19554141176152, 49.1306464546938], [-123.19551572689971, 49.13065442712741], [-123.19548829147747, 49.13066337930847], [-123.19548467249628, 49.13066457766549], [-123.19546085539045, 49.13067216489852], [-123.19543342078995, 49.13068133113986], [-123.19542939167586, 49.13068269814064], [-123.19540598566522, 49.130690366562874], [-123.19537855211874, 49.13069980615604], [-123.19537565971544, 49.13070081596834], [-123.19535111812424, 49.13070913436907], [-123.19532373297753, 49.13071893071706], [-123.19532368602287, 49.13071894710057], [-123.19529625346956, 49.130728647529644], [-123.19527374596659, 49.130737042161776], [-123.195268822866, 49.1307388471311], [-123.1952413926385, 49.13074914536871], [-123.19522605893235, 49.13075514969584], [-123.195213963968, 49.130759843055], [-123.19518653674218, 49.13077091175369], [-123.195180882378, 49.13077325296629], [-123.19515911065452, 49.13078227352045], [-123.19513826224878, 49.1307913518984], [-123.1951316869421, 49.13079424370046], [-123.19510426529905, 49.130806744596825], [-123.19509852951334, 49.13080944593577], [-123.19507684612674, 49.13081987873548], [-123.19506160761948, 49.13082753521068], [-123.19504943016359, 49.130833834604054], [-123.1950275084999, 49.1308456197057], [-123.1950220176757, 49.130848680394124], [-123.19499594636463, 49.130863699905966], [-123.19499460900502, 49.13086450367343], [-123.19496720452108, 49.13088139909142], [-123.19496660570154, 49.13088177634636], [-123.19493980472605, 49.13089949516498], [-123.19493927900139, 49.130899849378935], [-123.19491372420327, 49.130917919413726], [-123.19491241003928, 49.13091889938847], [-123.19488969540777, 49.13093598686704], [-123.19488502083578, 49.130939707972715], [-123.19486705998116, 49.130954051963585], [-123.1948576375251, 49.130962026006024], [-123.19484569450462, 49.130972114912545], [-123.19483026045744, 49.130985943491915], [-123.19482550646308, 49.13099017587069], [-123.19480622914425, 49.13100823528866], [-123.19480288987643, 49.13101152329413], [-123.19478768350028, 49.13102629346897], [-123.19477552612636, 49.13103885397671], [-123.19477011506089, 49.13104434999778], [-123.19475320681548, 49.13106240541029], [-123.19474816974088, 49.131068072533495], [-123.19473690693819, 49.13108045979415], [-123.19472151248391, 49.13109851264868], [-123.19472082142347, 49.13109935936124], [-123.19470638555593, 49.13111656504994], [-123.19469348259938, 49.13113307931066], [-123.19469224594384, 49.13113461578435], [-123.19467839419352, 49.131152666031554], [-123.1946661558582, 49.13116989479402], [-123.19466555350098, 49.13117071457243], [-123.194653010168, 49.13118876261048], [-123.1946415047191, 49.131206808897446], [-123.19463884709201, 49.13121131220602], [-123.19463052748712, 49.13122485429282], [-123.19462045462856, 49.13124289816265], [-123.19461156947555, 49.13126069934341], [-123.19461144378177, 49.131260940241496], [-123.19460302336833, 49.13127898132443], [-123.19459575747469, 49.13129702046088], [-123.1945896660167, 49.13131505761749], [-123.19458477620974, 49.13133309274857], [-123.19458438931524, 49.131335001801894], [-123.19458092678035, 49.131351126126084], [-123.19457841616442, 49.131369157247185], [-123.19457732743689, 49.131387185971974], [-123.19457773424186, 49.13140521217637], [-123.19457972690267, 49.131423235708134], [-123.19458341533108, 49.13144125638197], [-123.19458482344538, 49.131445928153106], [-123.19458872323993, 49.13145927432629], [-123.19459585663218, 49.13147728919365], [-123.19460507640763, 49.131495300543996], [-123.1946125339128, 49.13150709192096], [-123.19461640829407, 49.13151330833343], [-123.19462984929423, 49.13153131256642], [-123.19464014526848, 49.13154292115132], [-123.19464580056272, 49.13154931256595], [-123.19466430922122, 49.13156730825152], [-123.19466772332791, 49.13157023623315], [-123.19468547484462, 49.131585299454], [-123.1946952822504, 49.13159265661541], [-123.19470971103976, 49.13160328547445], [-123.1947228290114, 49.13161196543591], [-123.19473725893099, 49.13162126590423], [-123.19475036673379, 49.13162896129105], [-123.19476850063398, 49.131639240096376], [-123.19477789739985, 49.13164415114578], [-123.19480403054914, 49.13165720704507], [-123.19480542226002, 49.1316578549047], [-123.19483294211504, 49.131670277553745], [-123.19484441000503, 49.131675165799045], [-123.19486045770111, 49.131681607456414], [-123.19488796933501, 49.13169192591358], [-123.19489127722676, 49.13169311358799], [-123.194915477579, 49.1317013767658], [-123.19494298238584, 49.13170994832324], [-123.19494669242172, 49.13171104692551], [-123.19497048445034, 49.13171781815594], [-123.19499798355828, 49.131724931931], [-123.19501495286889, 49.13172895854118], [-123.19502548010429, 49.1317313905722], [-123.19505297449419, 49.13173729780741], [-123.19508046643972, 49.131742580399894], [-123.19510519983382, 49.13174683296564], [-123.19510795619726, 49.131747303946234], [-123.19513544463535, 49.131751689978564], [-123.19516293115558, 49.13175558618936], [-123.19519041590235, 49.1317590295653], [-123.19521789901069, 49.13176205470218], [-123.19524462579163, 49.13176462416768], [-123.19524538062674, 49.13176469897368], [-123.19527286156678, 49.13176717038162], [-123.19530034118323, 49.13176930413849], [-123.1953278195557, 49.131771120654214], [-123.19535529675134, 49.13177263715518], [-123.19538277282497, 49.13177386770782], [-123.19541024781927, 49.131774823294855], [-123.19543772176527, 49.13177551193859], [-123.19546519468311, 49.131775938854254], [-123.19549266658238, 49.1317761066099], [-123.19552013746298, 49.131776015274745], [-123.19554760731539, 49.13177566254751], [-123.19557507612134, 49.13177504389416], [-123.19560254385699, 49.13177415336006], [-123.1956300105037, 49.131772986322794], [-123.19565747605753, 49.131771541906666], [-123.19568494052025, 49.13176982066095], [-123.19571240387461, 49.13176781833724], [-123.1957398660663, 49.131765521259005], [-123.1957584206982, 49.13176375419086], [-123.1957673274805, 49.13176302735466], [-123.19579478877708, 49.131760504286184], [-123.19582224889842, 49.13175768353495], [-123.19584970775261, 49.131754541901195], [-123.19587716525221, 49.13175105730871], [-123.19590462132335, 49.13174721116666], [-123.19591619464258, 49.13174545969423], [-123.19593207759361, 49.13174341662591], [-123.19595953395938, 49.1317396473807], [-123.19598698932957, 49.131735626627155], [-123.19601444385567, 49.13173139289887], [-123.1960406950996, 49.13172722148195], [-123.19604189798228, 49.13172705904175], [-123.19606935524062, 49.13172352052745], [-123.19609681318931, 49.13172015802642], [-123.19612427282726, 49.131717224706684], [-123.19615173563872, 49.13171509659995], [-123.19617920363301, 49.13171428258701], [-123.19620667909408, 49.13171536087401], [-123.19623416383214, 49.13171878931315], [-123.19626165822433, 49.13172466244205], [-123.19626891532883, 49.13172683375952], [-123.19628916515626, 49.131733710140686], [-123.1963166793726, 49.13174460012096], [-123.1963170728384, 49.13174477877646], [-123.19634420318576, 49.131757917169566], [-123.19635382509897, 49.13176274316981], [-123.19637173063327, 49.13177215064584], [-123.1963880003864, 49.13178071193464], [-123.19639925998892, 49.13178686316796], [-123.19642138104355, 49.13179868204116], [-123.19642678974631, 49.13180167324529], [-123.19645431896657, 49.131816343233126], [-123.19645491713774, 49.13181665187351], [-123.19648184860293, 49.131831114394856], [-123.19648881666065, 49.13183462107759], [-123.19650937641642, 49.13184542021333], [-123.19652407184017, 49.13185258796421], [-123.19653690194309, 49.13185914351698], [-123.19656112957051, 49.13187055177136], [-123.19656442478257, 49.13187218329306], [-123.19659194681533, 49.1318850153856], [-123.1966001014021, 49.13188851230734], [-123.19661946682547, 49.13189733243881], [-123.19664154850513, 49.13190646861451], [-123.1966469837358, 49.13190886231567], [-123.19667449984058, 49.13192018532087], [-123.19668571739304, 49.13192442027024], [-123.19670201400612, 49.131931014994706], [-123.19672952550535, 49.131941167798296], [-123.19673299439437, 49.13194236661314], [-123.19675703701087, 49.13195131934254], [-123.19678374012874, 49.13196030702479], [-123.19678454507647, 49.13196059895136], [-123.19681205369197, 49.13197001486989], [-123.19683863960009, 49.13197824033282], [-123.1968395588222, 49.1319785478408], [-123.19686706438173, 49.13198718684704], [-123.19689456671773, 49.13199500945596], [-123.19689895781673, 49.13199616437402], [-123.1969220688419, 49.13200277639354], [-123.19694956847539, 49.13200991241736], [-123.19696724918302, 49.13201407478234], [-123.19697706631558, 49.13201659380171], [-123.19700456292409, 49.132022962485486], [-123.19703205677719, 49.132028634102745], [-123.19705034935807, 49.13203195987773], [-123.19705954859252, 49.132033790009665], [-123.19708703865133, 49.1320385013589], [-123.19711452581514, 49.13204248119922], [-123.19714201007316, 49.13204572710865], [-123.19716949134578, 49.13204821931296], [-123.19719417570943, 49.132049741215276], [-123.19719696952477, 49.132049930845206], [-123.19722444448311, 49.132050830012105], [-123.19725191556093, 49.132050750827986], [-123.19727938240167, 49.132049603849325], [-123.197279486398, 49.13204959548205], [-123.19730684485357, 49.132047351270536], [-123.19733430207842, 49.13204378237605], [-123.19736175326682, 49.132038693811815], [-123.19738919741154, 49.132031832516105], [-123.19739069991327, 49.13203137851693], [-123.19741663352241, 49.132022949860264], [-123.19744013402473, 49.13201326710548], [-123.19744405938097, 49.13201148805237], [-123.19747147229751, 49.13199677096971], [-123.19747403856401, 49.13199518223437], [-123.19749886779977, 49.13197767412409], [-123.19749957713941, 49.131977111663865], [-123.19751973676811, 49.1319590502896], [-123.19752623792786, 49.13195219580235], [-123.19753613138838, 49.13194099535324], [-123.19754962884207, 49.131922945371485], [-123.19755356870012, 49.1319168198687], [-123.19756098462337, 49.13190489905269], [-123.19757057452792, 49.13188685575441], [-123.19757862594875, 49.13186881508797], [-123.19758082670472, 49.13186314282101], [-123.19758566051621, 49.131850776161045], [-123.19759176660672, 49.13183273882259], [-123.19759701155316, 49.131814702957506], [-123.19760153980133, 49.13179666831868], [-123.19760546899003, 49.13177863470491], [-123.19760791132072, 49.13176585575768], [-123.19760896731746, 49.13176060182836], [-123.19761219558413, 49.13174256941385], [-123.19761502424487, 49.131724537683155], [-123.19761748137678, 49.13170650658821], [-123.19761957497428, 49.13168847611539], [-123.19762129335226, 49.1316704462847], [-123.19762260598709, 49.131652417148395], [-123.19762346732833, 49.13163438878445], [-123.1976238282911, 49.13161636127691], [-123.19762363293093, 49.13159833472153], [-123.19762280002152, 49.13158030925733], [-123.19762122386406, 49.131562285065215], [-123.1976187876584, 49.131544262345066], [-123.19761537325398, 49.13152624129903], [-123.19761086430348, 49.13150822212619], [-123.19760683684177, 49.13149551328065], [-123.19760528514058, 49.131490204784754], [-123.19759882729714, 49.13147218894676], [-123.19759104949601, 49.13145417536725], [-123.19758183268051, 49.131436164249706], [-123.19757911156618, 49.13143154864992], [-123.19757174695981, 49.13141815461821], [-123.19756034050667, 49.131400147245664], [-123.1975514668523, 49.131387841519945], [-123.19754760886367, 49.131382142139294], [-123.19753397309074, 49.13136413857829], [-123.19752385432416, 49.13135222366753], [-123.19751896577648, 49.13134613736196], [-123.19750302442986, 49.131328137741356], [-123.19749625990383, 49.13132115443092], [-123.19748608798238, 49.13131013982057], [-123.19746867711697, 49.13129300560942], [-123.19746784007488, 49.13129214414019], [-123.19744924796117, 49.13127414904552], [-123.19744110210044, 49.131266805621486], [-123.19742972394448, 49.13125615554129], [-123.19741353235653, 49.13124192623], [-123.19740940106749, 49.131238163399594], [-123.19738879537749, 49.13122017173777], [-123.19738596546627, 49.13121775868286], [-123.19736828977794, 49.13120217990109], [-123.19735839902779, 49.13119369818966], [-123.19734767839839, 49.13118418824155], [-123.19733083202216, 49.1311694880646], [-123.19732719183347, 49.131166196364966], [-123.19730745556538, 49.131148203202514], [-123.19730326120884, 49.13114431164138], [-123.19728865621666, 49.13113020843573], [-123.19727568415976, 49.13111755656276], [-123.19727043657974, 49.13111221267533], [-123.19725328818647, 49.1310942150819], [-123.19724809835704, 49.13108858748915], [-123.19723721651289, 49.131076215646544], [-123.19722152375128, 49.131058215561666], [-123.19722050218098, 49.131056995167434], [-123.19720712124091, 49.13104021327083], [-123.19719289522016, 49.131022674733195], [-123.19719253705641, 49.13102221128843], [-123.19717892941848, 49.13100420763641], [-123.19716528263285, 49.130986925827436], [-123.19716473800105, 49.13098620497965], [-123.1971511053147, 49.130968201367025], [-123.19713767147, 49.13095152614225], [-123.19713664194475, 49.13095019917106], [-123.19712248016113, 49.130932196458346], [-123.1971100654415, 49.130917411628836], [-123.19710743870127, 49.130914195245566], [-123.19709191553035, 49.130896194853094], [-123.19708247145626, 49.13088632581458], [-123.19707461343435, 49.13087819749488], [-123.19705489718035, 49.13086020425429], [-123.19705489718035, 49.13086020425429], [-123.19703256950055, 49.130842215466735], [-123.1970273401177, 49.130838419150685], [-123.19700659804867, 49.130824232892145], [-123.19699979612582, 49.13081992683099], [-123.1969768264194, 49.13080625679495], [-123.19697226098235, 49.130803662872566], [-123.19694473119199, 49.130788745783754], [-123.19694386187552, 49.13078828613633], [-123.19691720310111, 49.13077425363228], [-123.19690960706485, 49.13077031766875], [-123.19688967533101, 49.130759838419905], [-123.19687548662266, 49.13075234896183], [-123.19686214645577, 49.13074514006559], [-123.19684248226662, 49.13073437834202], [-123.1968346157091, 49.130729964865345], [-123.19681073367336, 49.13071640557218], [-123.19680708298763, 49.13071428651806], [-123.19677990374622, 49.130698431227884], [-123.19677954874892, 49.1306982204103], [-123.19675201330124, 49.130681844289256], [-123.19674964438113, 49.130680455903025], [-123.19672447810487, 49.13066552709506], [-123.19671919026106, 49.130662480902004], [-123.19669694419828, 49.130649531353434], [-123.19668792290688, 49.13064450727829], [-123.19666941249535, 49.13063408823587], [-123.19665517263695, 49.1306265361718], [-123.19664188378492, 49.13061939743987], [-123.19662017209454, 49.1306085688881], [-123.19661435870616, 49.130605620908554], [-123.196586836975, 49.13059268719299], [-123.19658201629574, 49.13059060696592], [-123.1965593183846, 49.13058054431133], [-123.19653940427229, 49.13057265261674], [-123.19653180431298, 49.13056954124073], [-123.19650429334618, 49.1305593206748], [-123.19649030309158, 49.130554709295296], [-123.19647678617058, 49.130550056652694], [-123.19644928250979, 49.13054167961902], [-123.19643071593258, 49.13053678379316], [-123.19642178279435, 49.13053429892686], [-123.19639428599234, 49.130527653746846], [-123.19636679360562, 49.13052212467749], [-123.19634722795807, 49.1305188989078], [-123.19633930478999, 49.130517498383625]]]}}, {"id": "1", "type": "Feature", "properties": {"r": 0.75, "r_true": 0.7500139020590956, "Contour_Level": "75 % Flux Source Area Contour"}, "geometry": {"type": "Polygon", "coordinates": [[[-123.1963959575265, 49.130950826617834], [-123.19636846451378, 49.13094519837135], [-123.19634097760644, 49.13094111462289], [-123.1963134963686, 49.13093846563654], [-123.19628602010519, 49.130937075944544], [-123.19625854828028, 49.130936810302394], [-123.19623108057107, 49.13093758740101], [-123.19620361675983, 49.1309393524964], [-123.196176156713, 49.130942072154596], [-123.19614870037947, 49.13094573382519], [-123.19612124778001, 49.1309503431721], [-123.19611304650134, 49.13095194232736], [-123.19609379625885, 49.130955227203096], [-123.19606634707235, 49.13096070463323], [-123.19603890164487, 49.130967136978505], [-123.1960274809308, 49.13097011452383], [-123.196011457553, 49.1309739099046], [-123.19598401588435, 49.130981299478364], [-123.1959615457682, 49.130988253341194], [-123.19595657818581, 49.13098969845637], [-123.19592914160525, 49.130998383483046], [-123.19590719207112, 49.131006372470466], [-123.19590170994486, 49.13100831967846], [-123.19587428086474, 49.13101891362227], [-123.19586134097166, 49.13102447715091], [-123.19584685709434, 49.131030858494555], [-123.19582310493993, 49.13104256889795], [-123.19581943987221, 49.13104446936739], [-123.19579202774948, 49.131059378994166], [-123.19578976389309, 49.13106065233175], [-123.1957646216924, 49.131075833323884], [-123.19576003946325, 49.131078729624], [-123.19573722520121, 49.13109472210494], [-123.19573432860628, 49.131096800104544], [-123.19571195209188, 49.13111486492741], [-123.19570984135129, 49.13111682765217], [-123.19569225379387, 49.13113292520664], [-123.19568247603165, 49.13114364760306], [-123.19567554561193, 49.131150980414965], [-123.19566112698185, 49.13116903174091], [-123.19565514093897, 49.13117815625253], [-123.19564888289284, 49.1311870793802], [-123.19563863241126, 49.13120512364012], [-123.19563086545956, 49.13122316369112], [-123.19562788481261, 49.131232744051], [-123.195624955755, 49.13124120059477], [-123.1956209609029, 49.131259234253804], [-123.19561922593915, 49.13127726408381], [-123.19561976870538, 49.131295290054695], [-123.19562270814538, 49.131313311964874], [-123.19562827271172, 49.13133132942709], [-123.19562827271172, 49.13133132942709], [-123.19563585335429, 49.13134934347296], [-123.19564661125847, 49.131367352134454], [-123.1956559318874, 49.131379149283944], [-123.19566067310141, 49.131385355196024], [-123.19567818623257, 49.13140335240674], [-123.19568351580216, 49.13140783337405], [-123.19569978704837, 49.13142134268637], [-123.19571107045995, 49.131429076833705], [-123.19572671324136, 49.13143932393449], [-123.19573860806622, 49.131445983097876], [-123.19576062065059, 49.131457293339956], [-123.19576613352557, 49.13145979963346], [-123.19579364987943, 49.13147130007499], [-123.19580437755329, 49.13147524603245], [-123.1958211590525, 49.13148097407735], [-123.19584866190813, 49.13148904158341], [-123.19586538171104, 49.131493169451524], [-123.19587615956907, 49.13149578826565], [-123.19590365353618, 49.131501595583565], [-123.19593114284756, 49.13150621984557], [-123.1959586280109, 49.13150979036818], [-123.1959707885443, 49.131511017482005], [-123.19598611060051, 49.13151270696546], [-123.19601359073755, 49.13151500064673], [-123.19604106810895, 49.131516592273556], [-123.1960685424895, 49.131517425038574], [-123.19609601356751, 49.131517420238396], [-123.19612348130076, 49.13151656750588], [-123.1961509456463, 49.13151485632087], [-123.1961784066225, 49.13151229169509], [-123.19619236188633, 49.13151064119206], [-123.19620586641811, 49.13150942862406], [-123.19623332724932, 49.13150682874266], [-123.19626079065678, 49.13150488222445], [-123.19628826161271, 49.13150484824075], [-123.1963157446193, 49.13150786621876], [-123.19632683640367, 49.131510412611526], [-123.19634324423781, 49.13151508988959], [-123.19637075362608, 49.13152478512946], [-123.19638050219234, 49.13152834823625], [-123.19639826824557, 49.13153580194817], [-123.19642578024505, 49.13154615250929], [-123.19642619800165, 49.13154629739518], [-123.19645329501473, 49.131557201253585], [-123.19647500692209, 49.13156424123853], [-123.19648080262152, 49.13156643435837], [-123.19650830849622, 49.13157522663105], [-123.19653580655142, 49.131582038303996], [-123.19653644904639, 49.131582163557624], [-123.19656330333376, 49.13158852610714], [-123.19659079356333, 49.13159335486597], [-123.19661827808956, 49.13159674007976], [-123.1966457572883, 49.13159877736474], [-123.19667323100175, 49.13159942740916], [-123.19670069856024, 49.131598521523024], [-123.19672815875968, 49.13159575605209], [-123.19675560979148, 49.13159067475282], [-123.19678304911717, 49.13158263723235], [-123.19678543567714, 49.131581739463435], [-123.19681047499436, 49.13157120455173], [-123.19682413825635, 49.13156364660409], [-123.19683788032037, 49.13155458407492], [-123.1968494342017, 49.13154557658966], [-123.19686525341056, 49.13152982698725], [-123.19686737591466, 49.13152751910932], [-123.19688096096313, 49.131509469055146], [-123.19689063815676, 49.131491425663334], [-123.19689255331906, 49.13148659707551], [-123.19689796747488, 49.13147338627458], [-123.19690299545977, 49.13145535080998], [-123.19690588840359, 49.13143731898621], [-123.19690726366521, 49.13141928975062], [-123.19690706380142, 49.13140126320119], [-123.19690478317527, 49.13138324020025], [-123.196900491684, 49.131365220628474], [-123.19689418468589, 49.13134720449355], [-123.19689198229243, 49.13134240195346], [-123.19688682725153, 49.131329190149486], [-123.19687787115555, 49.131311178530886], [-123.19686656974761, 49.13129317091045], [-123.19686430411147, 49.131290077337496], [-123.1968547072791, 49.131275164245466], [-123.1968407996576, 49.13125716106587], [-123.19683668388781, 49.131252377508545], [-123.19682648940922, 49.13123915857092], [-123.19681010364367, 49.13122115961205], [-123.19680908522574, 49.13122011412762], [-123.19679389141919, 49.131203160355], [-123.1967814993456, 49.13119107119979], [-123.1967758603462, 49.13118516419547], [-123.19675724584225, 49.13116716902732], [-123.19675392134235, 49.13116401059665], [-123.19673926943231, 49.131149172768815], [-123.19672634442786, 49.13113721756513], [-123.19672004631964, 49.131131178631605], [-123.19669965439536, 49.13111318648235], [-123.1966987753933, 49.131112408808846], [-123.19667992921286, 49.1310951931937], [-123.196671207703, 49.13108793293584], [-123.19665815386672, 49.1310772033936], [-123.19664365137733, 49.13106632362953], [-123.19663378577643, 49.13105921800496], [-123.19661610502418, 49.131047230083766], [-123.19660698416867, 49.13104123675498], [-123.19658856436692, 49.13102957173824], [-123.19657779036531, 49.131023259571634], [-123.19656103050124, 49.13101362636286], [-123.19654491349634, 49.13100528865051], [-123.19653350305605, 49.130999300786875], [-123.1965077158424, 49.130987325073875], [-123.19650598162161, 49.13098649203061], [-123.19647846394669, 49.1309746310487], [-123.19646302428089, 49.130969374236884], [-123.19645095483942, 49.130964935130564], [-123.19642345238961, 49.13095692166693], [-123.19639848439218, 49.13095145714652], [-123.1963959575265, 49.130950826617834]]]}}, {"id": "0", "type": "Feature", "properties": {"r": 0.5, "r_true": 0.49990207859402624, "Contour_Level": "50 % Flux Source Area Contour"}, "geometry": {"type": "Polygon", "coordinates": [[[-123.1963416532442, 49.13111220715616], [-123.19631417255225, 49.1311097203855], [-123.19628669753128, 49.13110866938872], [-123.19625922790935, 49.131108985863285], [-123.19623176499302, 49.13111100143903], [-123.19621133900701, 49.13111401735376], [-123.19620430938606, 49.13111486982486], [-123.19617685942126, 49.13112016925025], [-123.19614942092899, 49.13112837819137], [-123.19613940107845, 49.13113216647309], [-123.19612199162985, 49.131138920014294], [-123.19609960544335, 49.13115026096075], [-123.19609457750992, 49.13115331344928], [-123.19607249096217, 49.13116833390036], [-123.19606718400011, 49.131172937298174], [-123.19605187726586, 49.13118639579533], [-123.19603982797689, 49.13120207393719], [-123.19603787489757, 49.131204446461425], [-123.19602748848305, 49.1312224909867], [-123.19602150093938, 49.13124052804286], [-123.19601927077912, 49.13125855871972], [-123.19602072852385, 49.131276583135445], [-123.19602622162154, 49.131294600699995], [-123.1960363919933, 49.13131261032291], [-123.19604028245578, 49.13131733806013], [-123.19605057396674, 49.13133061313325], [-123.19606786369951, 49.13134529729589], [-123.19607190680584, 49.13134860379854], [-123.19609540371555, 49.1313627955514], [-123.1961029898826, 49.13136657789998], [-123.19612292242233, 49.131374886778836], [-123.19615042580102, 49.13138308933109], [-123.19615701090133, 49.13138451302559], [-123.19617792080233, 49.13138916642673], [-123.19620540608358, 49.13139277871932], [-123.19623288102345, 49.13139376982769], [-123.19626034659038, 49.13139238618795], [-123.19628780527238, 49.131389259004045], [-123.19631527124238, 49.13138797846713], [-123.19634276409361, 49.131393505305134], [-123.19637026937349, 49.13140217741021], [-123.19637026937349, 49.13140217741021], [-123.19639777878268, 49.13141189244651], [-123.19642527440638, 49.131418115376526], [-123.19644091378628, 49.13142008412923], [-123.19645276152103, 49.13142218306289], [-123.19648023803548, 49.13142356724416], [-123.1965077006152, 49.13142142536567], [-123.1965149954921, 49.13141995806459], [-123.19653514958584, 49.13141584128636], [-123.19656257751977, 49.13140493767498], [-123.19656812546015, 49.13140184073397], [-123.19658997164932, 49.13138548773319], [-123.19659185515205, 49.13138377344197], [-123.19660643550573, 49.13136572172496], [-123.19661407047273, 49.13134768183342], [-123.19661722867781, 49.13133137406494], [-123.19661761901848, 49.13132964890018], [-123.196617184804, 49.13132027955295], [-123.19661689358826, 49.131311623245004], [-123.19661313217003, 49.13129360275971], [-123.19660617440847, 49.131275587717035], [-123.19659490436946, 49.131257580016545], [-123.19658944032697, 49.13125111174572], [-123.19658100158578, 49.1312395767974], [-123.1965622204976, 49.13122158188163], [-123.19656185134855, 49.131221257021004], [-123.1965424526906, 49.13120358864237], [-123.19653428516587, 49.131197160791395], [-123.19651907436935, 49.13118560154506], [-123.19650673495028, 49.131177097730486], [-123.19649150818924, 49.131167621570015], [-123.1964791963138, 49.13115995915117], [-123.19646107222327, 49.13114964647145], [-123.19645166353135, 49.13114429734499], [-123.19642432123915, 49.13113168210835], [-123.1964241424713, 49.1311315983621], [-123.19639663200975, 49.13112157891682], [-123.19636913877999, 49.13111591965366], [-123.1963516520895, 49.13111377882171], [-123.1963416532442, 49.13111220715616]]]}}]}
    
    var EC_Station = {"type": "FeatureCollection", "features": [{"id": "4", "type": "Feature", "properties": {"name": "RBM", "Zm": 4.0, "lat": 49.131267, "lon": -123.196356, "canopy_height": 1.5}, "geometry": {"type": "Point", "coordinates": [-123.196356, 49.131267]}}]}

    map.on('load', () => {
        // Add a data sources containing GeoJSON data.

        // Add a data source containing GeoJSON data.
        map.addSource('Site_Name', {
            'type': 'geojson',
            'data': {"type": "FeatureCollection", "features": [{"id": "4", "type": "Feature", "properties": {"name": "RBM", "Zm": 4.0, "lat": 49.131267, "lon": -123.196356, "canopy_height": 1.5}, "geometry": {"type": "Point", "coordinates": [-123.196356, 49.131267]}}]}
        });

        map.addSource('FP_Contour_Levels', {
            'type': 'geojson',
            'data': FP_Contour_Levels
        });

        // Add a new layer to visualize the polygon.
        map.addLayer({
            'id': 'FP_Contour_Levels',
            'type': 'fill',
            'source': 'FP_Contour_Levels', // reference the data source
            'layout': {},
            'paint': {
                'fill-color': '#f76605', // blue color fill
                'fill-opacity': 0.15
                }
            });
        // Add a black outline around the polygon.
        map.addLayer({
            'id': 'outline',
            'type': 'line',
            'source': 'FP_Contour_Levels',
            'layout': {},
            'paint': {
                'line-color': '#000',
                'line-width': 3
                }
            });

        
        map.addLayer({'id': 'Site_Name',
                'type': 'circle',
                'source': 'Site_Name',
                'filter': ['==', '$type', 'Point'],
                'paint': {
                    'circle-radius': 10,
                    'circle-color': '#9803fc',
                    "circle-stroke-width": 1,
                    "circle-stroke-color": 'black'
                    },
                });

    });

    map.on('click', 'FP_Contour_Levels', (e) => {
        new mapboxgl.Popup()
            .setLngLat(e.lngLat)
            .setHTML(e.features[0].properties.Contour_Level)
            .addTo(map);
        });

        
    let bbox = turf.extent(FP_Contour_Levels);
    
    // fit zom to the bounding box of whichever layers are loaded
    function fit() {
        map.fitBounds(bbox, {maxZoom: 18});
        };

    fit();

    map.addControl(new mapboxgl.ScaleControl({position: 'bottom-right'}));
    
    // Call fit when clicking the zoomto button
    document.getElementById('zoomto').addEventListener('click', () => {
        fit()
    });
</script>

</body>
</html>