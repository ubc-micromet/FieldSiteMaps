<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Add a polygon to a map using a GeoJSON source</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
<link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
<!-- Import Turf Module - Needed to calculate bounding boxes -->
<script src='https://api.mapbox.com/mapbox.js/plugins/turf/v2.0.2/turf.min.js'></script>
<style>
    body { margin: 0; padding: 0; }
    #map { position: absolute; top: 0; bottom: 0; width: 100%; }

    /* Control the zoom to button */
    .btn-control {
        font: bold 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
        background-color: #3386c0;
        color: #fff;
        position: absolute;
        top: 20px;
        left: 50%;
        z-index: 1;
        border: none;
        width: 200px;
        margin-left: -100px;
        display: block;
        cursor: pointer;
        padding: 10px 20px;
        border-radius: 3px;
    }
    .btn-control:hover {
        background-color: #4ea0da;
    }
</style>
</head>
<body>
<button id="zoomto" class="btn-control">Zoom to Footprint</button>
<div id="map"></div>
<script>
	// Replace access token!
    mapboxgl.accessToken = 'pk.eyJ1IjoidWJjbWljcm9tZXQiLCJhIjoiY2xmMnJzYzlnMGFsYTNxcW1kYWhubjBiaSJ9.rhIOVatxQoS4M__qIFv6Pg';
  
    //  Custom mapStyle lest us use ESRI raster tiles
    const mapStyle = {
        version: 8,
        sources: {
        worldImagery: {
            type: "raster",
            tiles: ["https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"],
            tileSize: 256
            }
        },
        layers: [{
            id: "worldImagery",
            type: "raster",
            source: "worldImagery",
            minzoom: 0,
            maxzoom: 22
            }
        ]
    };

    //  Create the map - zoom and center are "arbitrary"
    const map = new mapboxgl.Map({
                container: 'map',
                zoom: 10,
                center: [-123.196356, 49.131267], // starting position
                style: mapStyle,
                });

    //  Locate the user
    var geolocate = new mapboxgl.GeolocateControl({
        positionOptions: {
        enableHighAccuracy: true
        },
        trackUserLocation: true,
        showUserHeading: true},);

    map.addControl(geolocate);
    map.addControl(new mapboxgl.NavigationControl());  

    var FP_Contour_Levels = {"type": "FeatureCollection", "features": [{"id": "2", "type": "Feature", "properties": {"r": 0.9, "r_true": 0.9000040144447176, "info": "90 % Flux Source Area Contour"}, "geometry": {"type": "Polygon", "coordinates": [[[-123.19631197570503, 49.130553326352384], [-123.19628449574363, 49.13055094599689], [-123.19625701763442, 49.13054903421166], [-123.19622954111064, 49.13054752360526], [-123.19620206596457, 49.13054636170937], [-123.1961745920509, 49.13054551183494], [-123.19614711928907, 49.13054495370182], [-123.19611964764168, 49.130544677941515], [-123.19609217709312, 49.130544680719666], [-123.19606470766333, 49.13054496720782], [-123.1960372394114, 49.130545552510895], [-123.19600977242806, 49.13054645977386], [-123.19598230682861, 49.130547718386616], [-123.19595484274694, 49.130549362462524], [-123.19592738032922, 49.1305514292565], [-123.19589991972816, 49.13055395770529], [-123.19588360312538, 49.130555740190616], [-123.19587246068646, 49.13055688269519], [-123.19584500302402, 49.13056015866149], [-123.19581754747882, 49.13056397314466], [-123.1957900941787, 49.1305683588256], [-123.19576264323506, 49.13057334424394], [-123.19575944546732, 49.1305739776572], [-123.19573519317188, 49.13057855471112], [-123.19570774526127, 49.13058431351734], [-123.1956802997388, 49.1305906807272], [-123.19567434889765, 49.1305921487982], [-123.19565285489229, 49.130597221507365], [-123.19562541181064, 49.1306042126822], [-123.19560313414759, 49.130610296359684], [-123.19559797046207, 49.130611646357885], [-123.19557052921218, 49.13061910720231], [-123.19554308993764, 49.130627072415514], [-123.19553852978305, 49.13062843268218], [-123.19551565041539, 49.130634976859625], [-123.19548821230387, 49.130643242333775], [-123.19547752063413, 49.13064656288169], [-123.19546077440022, 49.13065156299574], [-123.1954333372919, 49.13066008833052], [-123.19541902772734, 49.13066468879007], [-123.19540590076613, 49.13066876428825], [-123.19537846478299, 49.13067758076817], [-123.1953627892262, 49.13068281085421], [-123.19535102968321, 49.1306866245567], [-123.19532359523826, 49.130695837568176], [-123.19530901645807, 49.13070092871994], [-123.195296161873, 49.13070532804243], [-123.19526872961701, 49.130715103630756], [-123.19525806516366, 49.13071904178908], [-123.19524129847038, 49.13072516447507], [-123.19521386919908, 49.1307357057765], [-123.19521020372616, 49.130737149611605], [-123.19518644083492, 49.13074648112219], [-123.19516525967946, 49.13075525248289], [-123.19515901477232, 49.130757845853395], [-123.19513159034146, 49.130769629545114], [-123.19512324833384, 49.13077335038048], [-123.19510416812415, 49.13078198064713], [-123.19508421043247, 49.13079144323873], [-123.19507674873503, 49.13079505605545], [-123.19504933218859, 49.13080885976049], [-123.1950480286048, 49.13080953125892], [-123.1950219183942, 49.13082336897293], [-123.19501417511495, 49.1308276153351], [-123.19499450807852, 49.13083876926371], [-123.19498263841781, 49.13084569548884], [-123.19496710145826, 49.13085511627437], [-123.19495314987321, 49.13086377217561], [-123.19493969882474, 49.130872484709606], [-123.19492550132003, 49.13088184574841], [-123.19491230057459, 49.13089097617128], [-123.19489953779289, 49.13089991647018], [-123.19488490718358, 49.13091071251069], [-123.19487512687084, 49.13091798456553], [-123.19485751916035, 49.130931824038676], [-123.19485215668023, 49.13093605022426], [-123.19483051336182, 49.13095411363935], [-123.19483013702192, 49.13095444327086], [-123.19480978116418, 49.13097217551302], [-123.19480276123149, 49.13097868906652], [-123.19479020047314, 49.130990235440244], [-123.19477539266158, 49.1310047848216], [-123.19477177649259, 49.1310082934128], [-123.19475417895133, 49.13102634998833], [-123.19474803273698, 49.13103309508178], [-123.19473753259261, 49.13104440495685], [-123.19472200203059, 49.13106245804112], [-123.19472068328025, 49.13106408612104], [-123.19470705073122, 49.1310805101464], [-123.19469334742823, 49.13109856014526], [-123.19469334742823, 49.13109856014526], [-123.19468010952274, 49.13111660935771], [-123.19466809085421, 49.13113465651294], [-123.19466603100392, 49.131138005857004], [-123.1946566731297, 49.1311527026537], [-123.19464627577037, 49.13117074707311], [-123.19463874524276, 49.13118529536176], [-123.19463686363345, 49.13118878983068], [-123.1946280964647, 49.131206831500215], [-123.19462040337903, 49.13122487135857], [-123.19461375540588, 49.131242909454734], [-123.19461152762459, 49.13125000726721], [-123.19460792037017, 49.13126094618026], [-123.19460301999524, 49.13127898133012], [-123.19459918849961, 49.131297014678196], [-123.19459643107767, 49.13131504621583], [-123.1945947629278, 49.13133307591751], [-123.19459421018847, 49.13135110373921], [-123.194594811055, 49.13136912961659], [-123.1945966171012, 49.131387153462725], [-123.19459969483655, 49.13140517516541], [-123.19460412753409, 49.13142319458424], [-123.1946100173697, 49.1314412115468], [-123.19461229791003, 49.13144679869921], [-123.1946172168018, 49.131459226301594], [-123.19462594873747, 49.13147723847262], [-123.1946365086784, 49.13149524756139], [-123.1946399785516, 49.13150033498226], [-123.19464864958347, 49.131513253983876], [-123.19466281298551, 49.13153125699516], [-123.1946675915794, 49.13153658719159], [-123.19467889786551, 49.131549256764856], [-123.19469517436664, 49.131565106646846], [-123.19469738291743, 49.13156725248492], [-123.19471814812182, 49.13158524435664], [-123.1947227383249, 49.13158881038115], [-123.19474159646437, 49.13160323169907], [-123.1947502894333, 49.13160922689787], [-123.19476809415698, 49.13162121389281], [-123.19477783096035, 49.13162719190865], [-123.19479803175848, 49.13163919027684], [-123.19480536485676, 49.13164320432899], [-123.19483198015718, 49.13165715988518], [-123.19483289245575, 49.13165760519818], [-123.19486041469902, 49.13167063548539], [-123.19487042818655, 49.1316751218892], [-123.19488793242144, 49.13168250875948], [-123.19491478051317, 49.131693073913155], [-123.19491544600515, 49.131693322980965], [-123.19494295622452, 49.13170327610493], [-123.19496629396583, 49.131711013827974], [-123.19497046298574, 49.13171234456656], [-123.1949979671172, 49.13172073995535], [-123.19502546819275, 49.13172835392928], [-123.1950276775095, 49.131728937048265], [-123.19505296731117, 49.131735466876215], [-123.19508046388376, 49.131741928983395], [-123.1951033861678, 49.131746836030366], [-123.19510795817234, 49.13174780724557], [-123.19513545105278, 49.13175332506831], [-123.19516294180313, 49.131758298693164], [-123.19519043055404, 49.13176276161291], [-123.19520342534375, 49.1317646938308], [-123.19521791796394, 49.131766881747566], [-123.19524540407988, 49.13177067122052], [-123.19527288852187, 49.131774033416214], [-123.19530037137982, 49.13177699141014], [-123.19532785273637, 49.131779566404504], [-123.19535533266725, 49.13178177784165], [-123.1953649413372, 49.13178244753879], [-123.19538281168893, 49.13178375729156], [-123.195410289594, 49.1317854520811], [-123.19543776619284, 49.13178681409103], [-123.19546524152894, 49.131787854529456], [-123.19549271563977, 49.13178858305931], [-123.19552018855656, 49.131789007755636], [-123.19554766030414, 49.131789135055456], [-123.19557513090092, 49.13178896976273], [-123.19560260035976, 49.131788515277535], [-123.19563006868962, 49.13178777399147], [-123.19565753589525, 49.13178674723141], [-123.19568500197467, 49.13178543461898], [-123.19571246691724, 49.131783833576044], [-123.19573993070414, 49.13178193942639], [-123.1957415536947, 49.13178180967596], [-123.19576739442698, 49.131780029543236], [-123.19579485725623, 49.13177789329], [-123.1958223191167, 49.13177551165645], [-123.19584978001647, 49.13177288681343], [-123.19587723997904, 49.13177002481442], [-123.19590469902242, 49.13176693033684], [-123.1959321571787, 49.131763611620755], [-123.19593338864034, 49.13176345740669], [-123.19595961671828, 49.13176064480255], [-123.19598707589206, 49.13175758601129], [-123.19601453490142, 49.131754486374334], [-123.19604199400686, 49.13175141197356], [-123.19606945340409, 49.13174841242188], [-123.19609691372517, 49.13174564794302], [-123.19610324116967, 49.1317451421567], [-123.19612437722485, 49.13174369001976], [-123.19615184390211, 49.13174253806618], [-123.19617931491932, 49.131742486323944], [-123.19620679191655, 49.13174394992251], [-123.19621501866122, 49.1317449522542], [-123.19623427825802, 49.131747780596676], [-123.19626177474274, 49.13175417975534], [-123.19628927837739, 49.13176238813262], [-123.19629055970252, 49.131762850742824], [-123.19631679224801, 49.1317731865342], [-123.19633484552713, 49.13178080233432], [-123.19634431035892, 49.131785055631035], [-123.19637183234724, 49.13179790309817], [-123.19637360645123, 49.13179876330561], [-123.19639935839965, 49.131811775782424], [-123.19640935196692, 49.13181672939339], [-123.1964268848775, 49.13182575226341], [-123.19644490877852, 49.13183469579114], [-123.19645441082227, 49.13183958990962], [-123.19648106823547, 49.13185266115234], [-123.19648193550097, 49.131853103308494], [-123.19650946076763, 49.13186676167095], [-123.19651779367207, 49.13187062553886], [-123.19653698422228, 49.13187995781361], [-123.19655614513626, 49.13188858714557], [-123.19656450529456, 49.13189254767888], [-123.1965920247797, 49.13190473261968], [-123.19659638666921, 49.131906545521254], [-123.1966195436601, 49.13191676123015], [-123.19663877725738, 49.13192450022286], [-123.19664705960766, 49.13192804495538], [-123.196674574297, 49.13193900746055], [-123.19668393150793, 49.13194245020105], [-123.19670208756268, 49.13194960704751], [-123.19672959789622, 49.13195946264599], [-123.19673238463949, 49.13196039454064], [-123.1967571081853, 49.131969304245175], [-123.19678461482262, 49.13197822047425], [-123.19678498344987, 49.13197833179425], [-123.19681212173775, 49.13198720438691], [-123.1968396250716, 49.1319952812211], [-123.19684324195708, 49.131996259375], [-123.19686712809482, 49.13200327734777], [-123.19689462829143, 49.1320105574824], [-123.1969097099762, 49.132014172925864], [-123.19692212682074, 49.13201741463494], [-123.19694962387297, 49.13202389699267], [-123.19697711817366, 49.13202968303706], [-123.19698981441509, 49.13203206317378], [-123.1970046109997, 49.132035095308474], [-123.1970321020502, 49.13204005803883], [-123.19705959056668, 49.13204438005316], [-123.19708707666702, 49.13204809134849], [-123.19710310391262, 49.13204989672044], [-123.19711456082653, 49.13205131208095], [-123.19714204296585, 49.1320540224289], [-123.19716952248315, 49.13205607085777], [-123.19719699931453, 49.13205744153351], [-123.19722447333764, 49.13205810389527], [-123.1972519443669, 49.13205801145744], [-123.19727941214701, 49.132057100206076], [-123.19730687634492, 49.132055286555705], [-123.1973343365397, 49.13205246481981], [-123.19735539894619, 49.13204946575033], [-123.1973617923317, 49.13204853475771], [-123.19738924338813, 49.13204341300071], [-123.1974166884409, 49.132036780688786], [-123.19743504676406, 49.13203130269315], [-123.19744412664187, 49.132028424880026], [-123.19747155675695, 49.132018035586206], [-123.1974824035896, 49.13201319481569], [-123.19749897676486, 49.13200510481036], [-123.19751664606854, 49.13199510935405], [-123.19752638399723, 49.13198896197836], [-123.19754324144942, 49.13197703696602], [-123.1975537742622, 49.13196855346324], [-123.19756469246103, 49.131958973374445], [-123.19758114083804, 49.1319421895985], [-123.19758231332499, 49.131940916333285], [-123.19759709603264, 49.13192286414657], [-123.19760846907134, 49.13190618607403], [-123.19760937418368, 49.13190481624446], [-123.197619904708, 49.13188677133219], [-123.19762868167753, 49.131868729420425], [-123.19763572230693, 49.13185132566988], [-123.19763598035884, 49.13185069003836], [-123.19764232845485, 49.13183265228298], [-123.19764756497868, 49.13181461643], [-123.19765182870451, 49.131796582242025], [-123.19765523164043, 49.131778549527404], [-123.19765786206295, 49.13176051813513], [-123.19765978702198, 49.13174248795043], [-123.19766105445566, 49.13172445889128], [-123.1976616949054, 49.13170643090544], [-123.19766172288072, 49.131688403968056], [-123.19766113803502, 49.13167037807975], [-123.19765992635395, 49.13165235326447], [-123.19765806188937, 49.13163432956663], [-123.19765550835272, 49.131616307048326], [-123.19765221872545, 49.13159828579001], [-123.19764813483484, 49.13158026589119], [-123.1976431881592, 49.13156224746907], [-123.19763730071105, 49.131544230657056], [-123.19763447213833, 49.13153682391752], [-123.19763072146272, 49.13152621502882], [-123.19762335658507, 49.131508200744875], [-123.19761489266077, 49.131490188341445], [-123.19760675522413, 49.131474977843254], [-123.19760536121898, 49.13147217776439], [-123.19759533223731, 49.131454168037955], [-123.1975839948541, 49.13143616054964], [-123.19757910197269, 49.13142913453358], [-123.19757193211466, 49.131418154301386], [-123.19755890361081, 49.131400149704284], [-123.19755147855768, 49.131390787491924], [-123.19754501756348, 49.13138214657288], [-123.19753036860472, 49.13136414474496], [-123.1975238720592, 49.131356687786756], [-123.19751516117874, 49.13134614387048], [-123.19749917906556, 49.131328144319085], [-123.19749627527675, 49.13132502453001], [-123.1974830844724, 49.13131014495782], [-123.19746868507927, 49.13129501038218], [-123.19746608685266, 49.131292147138666], [-123.19744911342087, 49.13127414927558], [-123.19744109899764, 49.13126602427879], [-123.19743177441794, 49.131256152035085], [-123.19741399859788, 49.13123815553879], [-123.1974135154486, 49.131237667905886], [-123.19739687261838, 49.13122015792872], [-123.19738593071067, 49.13120900411972], [-123.19737949264663, 49.13120216075024], [-123.19736233380335, 49.13118416319112], [-123.19735834452433, 49.13117996741956], [-123.19734575830056, 49.131166164632354], [-123.19733075488999, 49.131150053830595], [-123.19732906973954, 49.131148166264374], [-123.19731325610333, 49.131130166398755], [-123.19730316016769, 49.1311188497084], [-123.19729744118044, 49.131112166533086], [-123.19728197496269, 49.1310941660694], [-123.19727556204718, 49.13108678038903], [-123.19726669217034, 49.1310761652902], [-123.19725114349812, 49.13105816496315], [-123.19724796328452, 49.131054540207785], [-123.19723574007735, 49.13104016438585], [-123.19722036823505, 49.13102322709513], [-123.19721942956564, 49.131022165355844], [-123.1972030487428, 49.13100416644358], [-123.1971927801771, 49.13099366802957], [-123.19718556320161, 49.130986169415614], [-123.19716692443896, 49.13096817435427], [-123.19716520199185, 49.130966590310315], [-123.19714743740569, 49.13095018073832], [-123.19713763284244, 49.13094178392493], [-123.19712642353917, 49.13093218972581], [-123.19711007214602, 49.13091910280203], [-123.19710391664964, 49.1309142012582], [-123.19708251830521, 49.13089814486735], [-123.19707991937678, 49.13089621533014], [-123.19705497011337, 49.1308786063808], [-123.19705443193538, 49.13087823194031], [-123.19702758329265, 49.13086025086765], [-123.19702742622594, 49.13086014864935], [-123.19699988535449, 49.13084244693038], [-123.19699960969108, 49.130842271708154], [-123.1969723463186, 49.13082520359852], [-123.19697087688388, 49.13082429383698], [-123.19694480862776, 49.130808295007256], [-123.19694155669696, 49.13080631696054], [-123.19691727167223, 49.130791567337695], [-123.19691192001393, 49.13078834061638], [-123.19688973516057, 49.13077494707559], [-123.19688207472701, 49.13077036462026], [-123.19686219910085, 49.130758436295096], [-123.19685199295274, 49.13075238901959], [-123.19683466364908, 49.13074207446739], [-123.19682155479349, 49.13073441401856], [-123.1968071290892, 49.130725933361234], [-123.19679056675713, 49.13071643994666], [-123.19677959577925, 49.130710103565505], [-123.19675875135843, 49.13069846727636], [-123.19675206416323, 49.130694697402156], [-123.19672578767411, 49.13068049655375], [-123.1967245346186, 49.13067981043063], [-123.1966970064102, 49.13066525706663], [-123.19669153546751, 49.13066252801675], [-123.19666948072161, 49.13065133665748], [-123.19665504112852, 49.130644563288456], [-123.19664195854953, 49.130638301492276], [-123.19661525677884, 49.13062660415117], [-123.19661444023313, 49.13062623770398], [-123.19658692411124, 49.13061472556636], [-123.19657043338907, 49.13060865357924], [-123.1965594129446, 49.1306044636578], [-123.1965319057689, 49.13059520853239], [-123.19651649315522, 49.13059071850743], [-123.1965044028745, 49.13058703408805], [-123.19647690348819, 49.13057974511745], [-123.19644940869617, 49.130573616895596], [-123.19644523084368, 49.13057281288385], [-123.19642191604814, 49.13056802966703], [-123.19639442677806, 49.13056329605722], [-123.1963669407003, 49.13055936942657], [-123.196339457357, 49.13055613415968], [-123.19632765850224, 49.13055498597127], [-123.19631197570503, 49.130553326352384]]]}}, {"id": "1", "type": "Feature", "properties": {"r": 0.75, "r_true": 0.7499936631384334, "info": "75 % Flux Source Area Contour"}, "geometry": {"type": "Polygon", "coordinates": [[[-123.19634101679068, 49.13095103734071], [-123.19631353196952, 49.13094748219988], [-123.19628605186885, 49.13094512178243], [-123.1962585756315, 49.1309437394254], [-123.19623110280382, 49.13094322060622], [-123.19620363340032, 49.13094356935869], [-123.19617616734433, 49.13094476662017], [-123.19614870459276, 49.13094680181447], [-123.19612124528824, 49.130949711467636], [-123.19610484992691, 49.130951956249284], [-123.19609378855435, 49.13095327371154], [-123.19606633370587, 49.130957315075555], [-123.19603888267667, 49.13096232621835], [-123.19601143595753, 49.13096843204945], [-123.1960045858443, 49.13097015339283], [-123.19598399084025, 49.13097494596362], [-123.1959565497569, 49.13098248522549], [-123.19593822603964, 49.13098829291775], [-123.19592911279186, 49.130991071681485], [-123.19590167892417, 49.131000446641636], [-123.19588623426957, 49.13100640802887], [-123.19587424977233, 49.131011021276834], [-123.19584682552501, 49.13102284397568], [-123.19584320152305, 49.13102450792053], [-123.19581940568115, 49.13103578805328], [-123.19580622590045, 49.131042597524065], [-123.19579199236799, 49.131050394171794], [-123.19577440100252, 49.1310606783822], [-123.19576458677909, 49.13106696615578], [-123.19574696705426, 49.1310787517873], [-123.19573719139782, 49.131086135637034], [-123.19572325576108, 49.131096818875356], [-123.19570980915118, 49.13110864729757], [-123.19570267739728, 49.13111488064826], [-123.19568493003246, 49.13113293761942], [-123.1956824454739, 49.131135883406], [-123.19566916706528, 49.131150991224835], [-123.19565632378566, 49.13116903988043], [-123.19565511312678, 49.131171088671714], [-123.19564496371704, 49.13118708602125], [-123.19563606092487, 49.131205127997305], [-123.19562944638653, 49.13122316609554], [-123.19562787130268, 49.13122931046648], [-123.19562446456317, 49.131241201427], [-123.19562146393679, 49.13125923340153], [-123.19562063597118, 49.131277261694855], [-123.19562203026416, 49.13129528622299], [-123.19562578652217, 49.13131330674917], [-123.19562822965909, 49.13132038754357], [-123.19563169377861, 49.1313313236306], [-123.19563998182731, 49.13134933647758], [-123.19565143438845, 49.131367343961564], [-123.19565590734008, 49.131372911437644], [-123.19566556072697, 49.13138534691326], [-123.19568349771276, 49.13140323723719], [-123.1956836026953, 49.13140334322694], [-123.19570499801743, 49.13142133385388], [-123.1957110566993, 49.131425581037206], [-123.19573140885277, 49.13143931597444], [-123.19573859828797, 49.131443499354994], [-123.19576406718068, 49.13145728749638], [-123.19576612755324, 49.13145828283598], [-123.19579364795327, 49.13147081094841], [-123.19580460469655, 49.13147524564726], [-123.19582116106422, 49.13148148485018], [-123.19584866764154, 49.13149049708932], [-123.19585796601667, 49.1314931820312], [-123.195876169524, 49.13149831510728], [-123.19590366658444, 49.13150490713806], [-123.19593115843742, 49.13151017588302], [-123.19593670144349, 49.13151107533315], [-123.1959586477887, 49.13151480841639], [-123.19598613339608, 49.13151848987267], [-123.19601361517404, 49.131521198961536], [-123.19604109348165, 49.13152302716326], [-123.19606856850244, 49.1315240213746], [-123.19609604036847, 49.13152421544372], [-123.1961235092519, 49.13152365333953], [-123.19615097542957, 49.131522405560695], [-123.19617843910639, 49.13152052431358], [-123.19620590072205, 49.131518121294086], [-123.19623336202197, 49.13151563894937], [-123.19626082641543, 49.13151394098875], [-123.19628829908264, 49.131514339203015], [-123.19631578506822, 49.13151811030298], [-123.19634328251342, 49.13152478220378], [-123.19635486884836, 49.131528391831935], [-123.19637079080248, 49.13153419777191], [-123.19639830283162, 49.13154455751677], [-123.19640322709513, 49.1315463364721], [-123.19642581789428, 49.131555682190296], [-123.19645055855892, 49.131564282838994], [-123.1964533273686, 49.13156538943866], [-123.19648083674048, 49.13157506803504], [-123.1965066040012, 49.13158221435608], [-123.19650833835742, 49.13158278183911], [-123.19653583899688, 49.13159024621136], [-123.19656333274146, 49.131595964493606], [-123.19658990509832, 49.13160009944187], [-123.19659082091684, 49.13160027269932], [-123.19661830627541, 49.131603867413865], [-123.1966457856722, 49.131605953782305], [-123.19667325923616, 49.13160656503343], [-123.19670072666266, 49.13160562478471], [-123.19672818719296, 49.13160294194128], [-123.19674682624465, 49.131599832151], [-123.1967556401598, 49.13159834860953], [-123.19678308463232, 49.1315916104056], [-123.19681051652732, 49.13158169671393], [-123.19681051652732, 49.13158169671393], [-123.19683793331625, 49.13156797017011], [-123.19684492595904, 49.13156361116554], [-123.19686532601946, 49.13154816455075], [-123.19686836877837, 49.13154554430629], [-123.19688555444729, 49.13152748811224], [-123.19689267539887, 49.13151742441086], [-123.19689812658721, 49.13150943978327], [-123.19690740395473, 49.131491397071876], [-123.19691361256984, 49.1314733595934], [-123.19691735527945, 49.13145532632015], [-123.19691902645776, 49.13143729657978], [-123.19691891042156, 49.131419269887466], [-123.19691710727038, 49.131401246072485], [-123.19691369036853, 49.131383225009635], [-123.19690878080458, 49.13136520649226], [-123.19690214769217, 49.13134719091394], [-123.19689347250069, 49.13132917881755], [-123.19689191929655, 49.13132649422229], [-123.19688426610222, 49.13131116762629], [-123.19687333423731, 49.13129315937636], [-123.19686426638414, 49.131280549066645], [-123.19686085706194, 49.13127515376015], [-123.19684778713439, 49.13125714915312], [-123.19683665099792, 49.13124406978849], [-123.19683287719977, 49.13123914768136], [-123.19681729734047, 49.13122114734962], [-123.19680905608817, 49.13121275317111], [-123.19680030253961, 49.13120314942747], [-123.19678147620797, 49.13118522517567], [-123.1967814064158, 49.131185154743285], [-123.19676251818909, 49.131167160042494], [-123.19675390448103, 49.131159749758055], [-123.1967419931292, 49.1311491681277], [-123.19672634090738, 49.13113632781094], [-123.19672019392856, 49.131131178380116], [-123.196698782918, 49.13111431083306], [-123.19669738217861, 49.131113190353325], [-123.1966740992907, 49.131095203124524], [-123.19667122806598, 49.131093080812754], [-123.19664960602391, 49.131077217952495], [-123.19664367802805, 49.13107306203889], [-123.19662339424339, 49.131059235701784], [-123.19661613365693, 49.131054470648316], [-123.19659524062862, 49.13104125675149], [-123.1965885943102, 49.131037144766715], [-123.19656411924203, 49.1310232828468], [-123.19656106195816, 49.13102158333112], [-123.19653353683745, 49.13100784693267], [-123.19652763226824, 49.13100531806673], [-123.19650601791881, 49.13099567592196], [-123.19648382844987, 49.13098736572678], [-123.19647850582612, 49.13098522883576], [-123.19645099655254, 49.130975492318804], [-123.19642928773058, 49.130969431637126], [-123.19642349472602, 49.13096763810354], [-123.19639599604334, 49.130960577588475], [-123.19636850390143, 49.130955171194685], [-123.19634397743599, 49.130951549850714], [-123.19634101679068, 49.13095103734071]]]}}, {"id": "0", "type": "Feature", "properties": {"r": 0.5, "r_true": 0.49995174252427116, "info": "50 % Flux Source Area Contour"}, "geometry": {"type": "Polygon", "coordinates": [[[-123.19631418009023, 49.13111162949919], [-123.1962867003493, 49.13110938319696], [-123.19625922768181, 49.131108928219064], [-123.19623176249952, 49.13111036965292], [-123.1962043060692, 49.13111402930526], [-123.1962043060692, 49.13111402930526], [-123.19617685446923, 49.13111891419722], [-123.19614941397559, 49.131126615657315], [-123.1961346404608, 49.13113217456018], [-123.19612198459534, 49.13113713666616], [-123.19609631085322, 49.131150266556325], [-123.19609456962858, 49.131151315144486], [-123.19606951828001, 49.131168338948505], [-123.19606717414142, 49.131170437291196], [-123.1960496107645, 49.13118639964383], [-123.19603981796979, 49.13119953594817], [-123.19603588609937, 49.131204449838165], [-123.19602582783816, 49.13122249380612], [-123.19602024063269, 49.13124053018254], [-123.19601841965178, 49.13125856016471], [-123.19602009251717, 49.131276584215215], [-123.19602566872297, 49.13129460163871], [-123.19603598737098, 49.13131261100991], [-123.19604028420642, 49.13131778205319], [-123.1960503060866, 49.13133061358811], [-123.19606786548488, 49.13134575003375], [-123.196071272149, 49.13134860487631], [-123.19609540758482, 49.131363776591215], [-123.19610060522963, 49.131366581950175], [-123.19612292968299, 49.13137672742447], [-123.19614687937482, 49.13138453023778], [-123.19615043581881, 49.13138562858131], [-123.19617793256596, 49.13139214778226], [-123.19620541737837, 49.1313956408566], [-123.19623289185385, 49.13139651390355], [-123.19626035791606, 49.13139525535016], [-123.19628781926691, 49.13139280377791], [-123.19631529029147, 49.13139280286241], [-123.19634278453537, 49.13139868168928], [-123.19635378272693, 49.13140220544894], [-123.19637029246095, 49.131408022938714], [-123.19639779708253, 49.131416525139755], [-123.1964150746099, 49.131420128088536], [-123.19642529340831, 49.13142292513725], [-123.1964527816647, 49.131427281105964], [-123.19648025755689, 49.13142850710375], [-123.1965077210775, 49.13142660259398], [-123.19653516989177, 49.13142097823748], [-123.19653847539313, 49.131419918098985], [-123.1965626026548, 49.13141129540082], [-123.19657949015745, 49.13140182138527], [-123.196590004945, 49.131393908460765], [-123.1966011371662, 49.13138375763725], [-123.19661373681357, 49.131365709291984], [-123.19661732731745, 49.13135631735668], [-123.19662086395414, 49.131347670264745], [-123.19662385675075, 49.13132963827773], [-123.19662272008924, 49.13131161332291], [-123.19661768714073, 49.13129359500309], [-123.1966170744111, 49.13129236412298], [-123.19661064124718, 49.131275580110774], [-123.19659941943804, 49.131257572328586], [-123.19658942179467, 49.131246424750124], [-123.1965839949431, 49.1312395717009], [-123.19656434185458, 49.13122157827015], [-123.19656184470001, 49.13121957530487], [-123.19654170419491, 49.1312035899165], [-123.19653428979423, 49.13119833167989], [-123.19651506309516, 49.131185608372405], [-123.1965067474898, 49.131180270439536], [-123.19648510293538, 49.1311676324704], [-123.19647921259784, 49.13116407986062], [-123.1964531953909, 49.13114965987403], [-123.19645168144517, 49.1311488311182], [-123.19642416075213, 49.13113622566993], [-123.19641004748891, 49.13113170639046], [-123.19639665325562, 49.131126957499006], [-123.19636915419916, 49.13111982370367], [-123.19634166481448, 49.13111513710015], [-123.19632958959099, 49.13111381633923], [-123.19631418009023, 49.13111162949919]]]}}]}
    
    var EC_Station = {"type": "FeatureCollection", "features": [{"id": "4", "type": "Feature", "properties": {"index": "RBM", "name": "Richmond Brackish Marsh", "Zm": 4.0, "bearing": 180, "lat": 49.131267, "lon": -123.196356, "canopy_height": 1.5, "webplot": "https://ibis.geog.ubc.ca/~micromet/data/RichmondBrackishMarsh.html#", "info": "https://ubc-micromet.github.io/Data.html#delta-salt-marsh"}, "geometry": {"type": "Point", "coordinates": [-123.196356, 49.131267]}}]}

    map.on('load', () => {
        // Add a data sources containing GeoJSON data.

        // Add a data source containing GeoJSON data.
        map.addSource('Site_Name', {
            'type': 'geojson',
            'data': {"type": "FeatureCollection", "features": [{"id": "4", "type": "Feature", "properties": {"index": "RBM", "name": "Richmond Brackish Marsh", "Zm": 4.0, "bearing": 180, "lat": 49.131267, "lon": -123.196356, "canopy_height": 1.5, "webplot": "https://ibis.geog.ubc.ca/~micromet/data/RichmondBrackishMarsh.html#", "info": "https://ubc-micromet.github.io/Data.html#delta-salt-marsh"}, "geometry": {"type": "Point", "coordinates": [-123.196356, 49.131267]}}]}
        });

        map.addSource('FP_Contour_Levels', {
            'type': 'geojson',
            'data': FP_Contour_Levels
        });

        // Add a new layer to visualize the polygon.
        map.addLayer({
            'id': 'FP_Contour_Levels',
            'type': 'fill',
            'source': 'FP_Contour_Levels', // reference the data source
            'layout': {},
            'paint': {
                'fill-color': '#f76605', // blue color fill
                'fill-opacity': 0.15
                }
            });
        // Add a black outline around the polygon.
        map.addLayer({
            'id': 'outline',
            'type': 'line',
            'source': 'FP_Contour_Levels',
            'layout': {},
            'paint': {
                'line-color': '#000',
                'line-width': 3
                }
            });

        
        map.addLayer({'id': 'Site_Name',
                'type': 'circle',
                'source': 'Site_Name',
                'filter': ['==', '$type', 'Point'],
                'paint': {
                    'circle-radius': 10,
                    'circle-color': '#9803fc',
                    "circle-stroke-width": 1,
                    "circle-stroke-color": 'black'
                    },
                });

    });

    map.on('click', 'FP_Contour_Levels', (e) => {
        new mapboxgl.Popup()
            .setLngLat(e.lngLat)
            .setHTML(e.features[0].properties.Contour_Level)
            .addTo(map);
        });

        
    let bbox = turf.extent(FP_Contour_Levels);
    
    // fit zom to the bounding box of whichever layers are loaded
    function fit() {
        map.fitBounds(bbox, {maxZoom: 18});
        };

    fit();

    map.addControl(new mapboxgl.ScaleControl({position: 'bottom-right'}));
    
    // Call fit when clicking the zoomto button
    document.getElementById('zoomto').addEventListener('click', () => {
        fit()
    });
</script>

</body>
</html>